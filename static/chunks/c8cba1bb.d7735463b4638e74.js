(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{80510:function(a,b,c){var d=c(34155);!function(b,c){a.exports=c()}(self,function(){return(function(){var a={"./node_modules/es6-promise/dist/es6-promise.js":function(a,b,c){!function(b,c){a.exports=c()}(this,function(){"use strict";function a(a){return"function"==typeof a}var b=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=0,f=void 0,g=void 0,h=function(a,b){n[e]=a,n[e+1]=b,2===(e+=2)&&(g?g(o):p())},i="undefined"!=typeof window?window:void 0,j=i||{},k=j.MutationObserver||j.WebKitMutationObserver,l="undefined"==typeof self&& void 0!==d&&"[object process]"===({}).toString.call(d);function m(){var a=setTimeout;return function(){return a(o,1)}}var n=new Array(1000);function o(){for(var a=0;a<e;a+=2){var b=n[a],c=n[a+1];b(c),n[a]=void 0,n[a+1]=void 0}e=0}var p=void 0;function q(a,b){var c=this,d=new this.constructor(t);void 0===d[s]&&I(d);var e=c._state;if(e){var f=arguments[e-1];h(function(){return G(e,d,f,c._result)})}else E(c,d,a,b);return d}function r(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=new this(t);return A(b,a),b}p=l?function(){return d.nextTick(o)}:k?(u=0,v=new k(o),w=document.createTextNode(""),v.observe(w,{characterData:!0}),function(){w.data=u=++u%2}):"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel?((x=new MessageChannel()).port1.onmessage=o,function(){return x.port2.postMessage(0)}):void 0===i?(function(){try{var a=Function("return this")().require("vertx");return f=a.runOnLoop||a.runOnContext,void 0!==f?function(){f(o)}:m()}catch(b){return m()}})():m();var s=Math.random().toString(36).substring(2);function t(){}var u,v,w,x,y=void 0;function z(b,c,d){var e,f,g,i,j;c.constructor===b.constructor&&d===q&&c.constructor.resolve===r?(e=b,1===(f=c)._state?C(e,f._result):2===f._state?D(e,f._result):E(f,void 0,function(a){return A(e,a)},function(a){return D(e,a)})):void 0===d?C(b,c):a(d)?(g=b,i=c,j=d,h(function(a){var b=!1,c=function(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}(j,i,function(c){b||(b=!0,i!==c?A(a,c):C(a,c))},function(c){b||(b=!0,D(a,c))},"Settle: "+(a._label||" unknown promise"));!b&&c&&(b=!0,D(a,c))},g)):C(b,c)}function A(a,b){var c,d;if(a===b)D(a,new TypeError("You cannot resolve a promise with itself"));else if(d=typeof(c=b),null!==c&&("object"===d||"function"===d)){var e=void 0;try{e=b.then}catch(f){D(a,f);return}z(a,b,e)}else C(a,b)}function B(a){a._onerror&&a._onerror(a._result),F(a)}function C(a,b){a._state===y&&(a._result=b,a._state=1,0!==a._subscribers.length&&h(F,a))}function D(a,b){a._state===y&&(a._state=2,a._result=b,h(B,a))}function E(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+1]=c,e[f+2]=d,0===f&&a._state&&h(F,a)}function F(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?G(c,d,e,f):e(f);a._subscribers.length=0}}function G(b,c,d,e){var f=a(d),g=void 0,h=void 0,i=!0;if(f){try{g=d(e)}catch(j){i=!1,h=j}if(c===g){D(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e;c._state!==y||(f&&i?A(c,g):!1===i?D(c,h):1===b?C(c,g):2===b&&D(c,g))}var H=0;function I(a){a[s]=H++,a._state=void 0,a._result=void 0,a._subscribers=[]}var J=function(){function a(a,c){this._instanceConstructor=a,this.promise=new a(t),this.promise[s]||I(this.promise),b(c)?(this.length=c.length,this._remaining=c.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(c),0===this._remaining&&C(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return a.prototype._enumerate=function(a){for(var b=0;this._state===y&&b<a.length;b++)this._eachEntry(a[b],b)},a.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===r){var e=void 0,f=void 0,g=!1;try{e=a.then}catch(h){g=!0,f=h}if(e===q&&a._state!==y)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===K){var i=new c(t);g?D(i,f):z(i,a,e),this._willSettleAt(i,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===y&&(this._remaining--,2===a?D(d,c):this._result[b]=c),0===this._remaining&&C(d,this._result)},a.prototype._willSettleAt=function(a,b){var c=this;E(a,void 0,function(a){return c._settledAt(1,b,a)},function(a){return c._settledAt(2,b,a)})},a}(),K=function(){function b(a){this[s]=H++,this._result=this._state=void 0,this._subscribers=[],t!==a&&("function"!=typeof a&&(function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")})(),this instanceof b?(function(a,b){try{b(function(b){A(a,b)},function(b){D(a,b)})}catch(c){D(a,c)}})(this,a):(function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")})())}return b.prototype.catch=function(a){return this.then(null,a)},b.prototype.finally=function(b){var c=this.constructor;return a(b)?this.then(function(a){return c.resolve(b()).then(function(){return a})},function(a){return c.resolve(b()).then(function(){throw a})}):this.then(b,b)},b}();return K.prototype.then=q,K.all=function(a){return new J(this,a).promise},K.race=function(a){var c=this;return new c(b(a)?function(b,d){for(var e=a.length,f=0;f<e;f++)c.resolve(a[f]).then(b,d)}:function(a,b){return b(new TypeError("You must pass an array to race."))})},K.resolve=r,K.reject=function(a){var b=new this(t);return D(b,a),b},K._setScheduler=function(a){g=a},K._setAsap=function(a){h=a},K._asap=h,K.polyfill=function(){var a=void 0;if(void 0!==c.g)a=c.g;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var d=a.Promise;if(d){var e=null;try{e=Object.prototype.toString.call(d.resolve())}catch(f){}if("[object Promise]"===e&&!d.cast)return}a.Promise=K},K.Promise=K,K})},"./node_modules/events/events.js":function(a){"use strict";var b,c="object"==typeof Reflect?Reflect:null,d=c&&"function"==typeof c.apply?c.apply:function(a,b,c){return Function.prototype.apply.call(a,b,c)};b=c&&"function"==typeof c.ownKeys?c.ownKeys:Object.getOwnPropertySymbols?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:function(a){return Object.getOwnPropertyNames(a)};var e=Number.isNaN||function(a){return a!=a};function f(){f.init.call(this)}a.exports=f,a.exports.once=function(a,b){return new Promise(function(c,d){function e(c){a.removeListener(b,f),d(c)}function f(){"function"==typeof a.removeListener&&a.removeListener("error",e),c([].slice.call(arguments))}r(a,b,f,{once:!0}),"error"!==b&&q(a,e,{once:!0})})},f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var g=10;function h(a){if("function"!=typeof a)throw new TypeError("The \"listener\" argument must be of type Function. Received type "+typeof a)}function i(a){return void 0===a._maxListeners?f.defaultMaxListeners:a._maxListeners}function j(a,b,c,d){if(h(c),void 0===(f=a._events)?(f=a._events=Object.create(null),a._eventsCount=0):(void 0!==f.newListener&&(a.emit("newListener",b,c.listener?c.listener:c),f=a._events),g=f[b]),void 0===g)g=f[b]=c,++a._eventsCount;else if("function"==typeof g?g=f[b]=d?[c,g]:[g,c]:d?g.unshift(c):g.push(c),(e=i(a))>0&&g.length>e&&!g.warned){g.warned=!0;var e,f,g,j,k=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=a,k.type=b,k.count=g.length,j=k,console&&console.warn&&console.warn(j)}return a}function k(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(a,b,c){var d={fired:!1,wrapFn:void 0,target:a,type:b,listener:c},e=k.bind(d);return e.listener=c,d.wrapFn=e,e}function m(a,b,c){var d=a._events;if(void 0===d)return[];var e=d[b];return void 0===e?[]:"function"==typeof e?c?[e.listener||e]:[e]:c?p(e):o(e,e.length)}function n(a){var b=this._events;if(void 0!==b){var c=b[a];if("function"==typeof c)return 1;if(void 0!==c)return c.length}return 0}function o(a,b){for(var c=new Array(b),d=0;d<b;++d)c[d]=a[d];return c}function p(a){for(var b=new Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}function q(a,b,c){"function"==typeof a.on&&r(a,"error",b,c)}function r(a,b,c,d){if("function"==typeof a.on)d.once?a.once(b,c):a.on(b,c);else if("function"==typeof a.addEventListener)a.addEventListener(b,function e(f){d.once&&a.removeEventListener(b,e),c(f)});else throw new TypeError("The \"emitter\" argument must be of type EventEmitter. Received type "+typeof a)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(a){if("number"!=typeof a||a<0||e(a))throw new RangeError("The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received "+a+".");g=a}}),f.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(a){if("number"!=typeof a||a<0||e(a))throw new RangeError("The value of \"n\" is out of range. It must be a non-negative number. Received "+a+".");return this._maxListeners=a,this},f.prototype.getMaxListeners=function(){return i(this)},f.prototype.emit=function(a){for(var b,c=[],e=1;e<arguments.length;e++)c.push(arguments[e]);var f="error"===a,g=this._events;if(void 0!==g)f=f&& void 0===g.error;else if(!f)return!1;if(f){if(c.length>0&&(b=c[0]),b instanceof Error)throw b;var h=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw h.context=b,h}var i=g[a];if(void 0===i)return!1;if("function"==typeof i)d(i,this,c);else for(var j=i.length,k=o(i,j),e=0;e<j;++e)d(k[e],this,c);return!0},f.prototype.addListener=function(a,b){return j(this,a,b,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(a,b){return j(this,a,b,!0)},f.prototype.once=function(a,b){return h(b),this.on(a,l(this,a,b)),this},f.prototype.prependOnceListener=function(a,b){return h(b),this.prependListener(a,l(this,a,b)),this},f.prototype.removeListener=function(a,b){var c,d,e,f,g;if(h(b),void 0===(d=this._events))return this;if(void 0===(c=d[a]))return this;if(c===b||c.listener===b)0== --this._eventsCount?this._events=Object.create(null):(delete d[a],d.removeListener&&this.emit("removeListener",a,c.listener||b));else if("function"!=typeof c){for(e=-1,f=c.length-1;f>=0;f--)if(c[f]===b||c[f].listener===b){g=c[f].listener,e=f;break}if(e<0)return this;0===e?c.shift():(function(a,b){for(;b+1<a.length;b++)a[b]=a[b+1];a.pop()})(c,e),1===c.length&&(d[a]=c[0]),void 0!==d.removeListener&&this.emit("removeListener",a,g||b)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(a){var b,c,d;if(void 0===(c=this._events))return this;if(void 0===c.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==c[a]&&(0== --this._eventsCount?this._events=Object.create(null):delete c[a]),this;if(0===arguments.length){var e,f=Object.keys(c);for(d=0;d<f.length;++d)"removeListener"!==(e=f[d])&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(b=c[a]))this.removeListener(a,b);else if(void 0!==b)for(d=b.length-1;d>=0;d--)this.removeListener(a,b[d]);return this},f.prototype.listeners=function(a){return m(this,a,!0)},f.prototype.rawListeners=function(a){return m(this,a,!1)},f.listenerCount=function(a,b){return"function"==typeof a.listenerCount?a.listenerCount(b):n.call(a,b)},f.prototype.listenerCount=n,f.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},"./node_modules/webworkify-webpack/index.js":function(a,b,c){function d(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}c.m=a,c.c=b,c.i=function(a){return a},c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{configurable:!1,enumerable:!0,get:d})},c.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="/",c.oe=function(a){throw console.error(a),a};var d=c(c.s=ENTRY_MODULE);return d.default||d}var e="[\\.|\\-|\\+|\\w|/|@]+",f="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+e+").*?\\)";function g(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function h(a){return!isNaN(1*a)}function i(a,b,d){var i,j={};j[d]=[];var k=b.toString(),l=k.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return j;for(var m=l[1],n=new RegExp("(\\\\n|\\W)"+g(m)+f,"g");i=n.exec(k);)"dll-reference"!==i[3]&&j[d].push(i[3]);for(n=new RegExp("\\("+g(m)+"\\(\"(dll-reference\\s("+e+"))\"\\)\\)"+f,"g");i=n.exec(k);)a[i[2]]||(j[d].push(i[1]),a[i[2]]=c(i[1]).m),j[i[2]]=j[i[2]]||[],j[i[2]].push(i[4]);for(var o=Object.keys(j),p=0;p<o.length;p++)for(var q=0;q<j[o[p]].length;q++)h(j[o[p]][q])&&(j[o[p]][q]=1*j[o[p]][q]);return j}function j(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:function(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};j(c);)for(var f=Object.keys(c),g=0;g<f.length;g++){var h=f[g],k=c[h].pop();if(e[h]=e[h]||{},!e[h][k]&&a[h][k]){e[h][k]=!0,d[h]=d[h]||[],d[h].push(k);for(var l=i(a,a[h][k],h),m=Object.keys(l),n=0;n<m.length;n++)c[m[n]]=c[m[n]]||[],c[m[n]]=c[m[n]].concat(l[m[n]])}}return d}(e,a),g="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return""+JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),g=g+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return""+JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var h=new window.Blob([g],{type:"text/javascript"});if(b.bare)return h;var k=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.js":function(a,b,c){"use strict";c.r(b),c.d(b,{defaultConfig:function(){return d},createDefaultConfig:function(){return e}});var d={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function e(){return Object.assign({},d)}},"./src/core/features.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/io/io-controller.js"),e=c("./src/config.js"),f=function(){function a(){}return a.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported("video/mp4; codecs=\"avc1.42E01E,mp4a.40.2\"")},a.supportNetworkStreamIO=function(){var a=new d.default({},(0,e.createDefaultConfig)()),b=a.loaderType;return a.destroy(),"fetch-stream-loader"==b||"xhr-moz-chunked-loader"==b},a.getNetworkLoaderTypeName=function(){var a=new d.default({},(0,e.createDefaultConfig)()),b=a.loaderType;return a.destroy(),b},a.supportNativeMediaPlayback=function(b){void 0==a.videoElement&&(a.videoElement=window.document.createElement("video"));var c=a.videoElement.canPlayType(b);return"probably"===c||"maybe"==c},a.getFeatureList=function(){var b={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return b.mseFlvPlayback=a.supportMSEH264Playback(),b.networkStreamIO=a.supportNetworkStreamIO(),b.networkLoaderName=a.getNetworkLoaderTypeName(),b.mseLiveFlvPlayback=b.mseFlvPlayback&&b.networkStreamIO,b.nativeMP4H264Playback=a.supportNativeMediaPlayback("video/mp4; codecs=\"avc1.42001E, mp4a.40.2\""),b.nativeWebmVP8Playback=a.supportNativeMediaPlayback("video/webm; codecs=\"vp8.0, vorbis\""),b.nativeWebmVP9Playback=a.supportNativeMediaPlayback("video/webm; codecs=\"vp9\""),b},a}();b.default=f},"./src/core/media-info.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return a.prototype.isComplete=function(){var a=!1===this.hasAudio|| !0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,b=!1===this.hasVideo|| !0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&a&&b},a.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},a.prototype.getNearestKeyframe=function(a){if(null==this.keyframesIndex)return null;var b=this.keyframesIndex,c=this._search(b.times,a);return{index:c,milliseconds:b.times[c],fileposition:b.filepositions[c]}},a.prototype._search=function(a,b){var c=0,d=a.length-1,e=0,f=0,g=d;for(b<a[0]&&(c=0,f=g+1);f<=g;){if((e=f+Math.floor((g-f)/2))===d||b>=a[e]&&b<a[e+1]){c=e;break}a[e]<b?f=e+1:g=e-1}return c},a}();b.default=d},"./src/core/media-segment-info.js":function(a,b,c){"use strict";c.r(b),c.d(b,{SampleInfo:function(){return d},MediaSegmentInfo:function(){return e},IDRSampleList:function(){return f},MediaSegmentInfoList:function(){return g}});var d=function(a,b,c,d,e){this.dts=a,this.pts=b,this.duration=c,this.originalDts=d,this.isSyncPoint=e,this.fileposition=null},e=function(){function a(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return a.prototype.appendSyncPoint=function(a){a.isSyncPoint=!0,this.syncPoints.push(a)},a}(),f=function(){function a(){this._list=[]}return a.prototype.clear=function(){this._list=[]},a.prototype.appendArray=function(a){var b=this._list;0!==a.length&&(b.length>0&&a[0].originalDts<b[b.length-1].originalDts&&this.clear(),Array.prototype.push.apply(b,a))},a.prototype.getLastSyncPointBeforeDts=function(a){if(0==this._list.length)return null;var b=this._list,c=0,d=b.length-1,e=0,f=0,g=d;for(a<b[0].dts&&(c=0,f=g+1);f<=g;){if((e=f+Math.floor((g-f)/2))===d||a>=b[e].dts&&a<b[e+1].dts){c=e;break}b[e].dts<a?f=e+1:g=e-1}return this._list[c]},a}(),g=function(){function a(a){this._type=a,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),a.prototype.isEmpty=function(){return 0===this._list.length},a.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},a.prototype._searchNearestSegmentBefore=function(a){var b=this._list;if(0===b.length)return -2;var c=b.length-1,d=0,e=0,f=c,g=0;if(a<b[0].originalBeginDts)return g=-1;for(;e<=f;){if((d=e+Math.floor((f-e)/2))===c||a>b[d].lastSample.originalDts&&a<b[d+1].originalBeginDts){g=d;break}b[d].originalBeginDts<a?e=d+1:f=d-1}return g},a.prototype._searchNearestSegmentAfter=function(a){return this._searchNearestSegmentBefore(a)+1},a.prototype.append=function(a){var b=this._list,c=a,d=this._lastAppendLocation,e=0;-1!==d&&d<b.length&&c.originalBeginDts>=b[d].lastSample.originalDts&&(d===b.length-1||d<b.length-1&&c.originalBeginDts<b[d+1].originalBeginDts)?e=d+1:b.length>0&&(e=this._searchNearestSegmentBefore(c.originalBeginDts)+1),this._lastAppendLocation=e,this._list.splice(e,0,c)},a.prototype.getLastSegmentBefore=function(a){var b=this._searchNearestSegmentBefore(a);return b>=0?this._list[b]:null},a.prototype.getLastSampleBefore=function(a){var b=this.getLastSegmentBefore(a);return null!=b?b.lastSample:null},a.prototype.getLastSyncPointBefore=function(a){for(var b=this._searchNearestSegmentBefore(a),c=this._list[b].syncPoints;0===c.length&&b>0;)b--,c=this._list[b].syncPoints;return c.length>0?c[c.length-1]:null},a}()},"./src/core/mse-controller.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./src/utils/logger.js"),g=c("./src/utils/browser.js"),h=c("./src/core/mse-events.js"),i=c("./src/core/media-segment-info.js"),j=c("./src/utils/exception.js"),k=function(){function a(a){this.TAG="MSEController",this._config=a,this._emitter=new(e())(),this._config.isLive&& void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new i.IDRSampleList()}return a.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(a,b){this._emitter.addListener(a,b)},a.prototype.off=function(a,b){this._emitter.removeListener(a,b)},a.prototype.attachMediaElement=function(a){if(this._mediaSource)throw new j.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var b=this._mediaSource=new window.MediaSource();b.addEventListener("sourceopen",this.e.onSourceOpen),b.addEventListener("sourceended",this.e.onSourceEnded),b.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=a,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),a.src=this._mediaSourceObjectURL},a.prototype.detachMediaElement=function(){if(this._mediaSource){var a=this._mediaSource;for(var b in this._sourceBuffers){var c=this._pendingSegments[b];c.splice(0,c.length),this._pendingSegments[b]=null,this._pendingRemoveRanges[b]=null,this._lastInitSegments[b]=null;var d=this._sourceBuffers[b];if(d){if("closed"!==a.readyState){try{a.removeSourceBuffer(d)}catch(e){f.default.e(this.TAG,e.message)}d.removeEventListener("error",this.e.onSourceBufferError),d.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[b]=null,this._sourceBuffers[b]=null}}if("open"===a.readyState)try{a.endOfStream()}catch(g){f.default.e(this.TAG,g.message)}a.removeEventListener("sourceopen",this.e.onSourceOpen),a.removeEventListener("sourceended",this.e.onSourceEnded),a.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},a.prototype.appendInitSegment=function(a,b){if(!this._mediaSource||"open"!==this._mediaSource.readyState){this._pendingSourceBufferInit.push(a),this._pendingSegments[a.type].push(a);return}var c=a,d=""+c.container;c.codec&&c.codec.length>0&&(d+=";codecs="+c.codec);var e=!1;if(f.default.v(this.TAG,"Received Initialization Segment, mimeType: "+d),this._lastInitSegments[c.type]=c,d!==this._mimeTypes[c.type]){if(this._mimeTypes[c.type])f.default.v(this.TAG,"Notice: "+c.type+" mimeType changed, origin: "+this._mimeTypes[c.type]+", target: "+d);else{e=!0;try{var i=this._sourceBuffers[c.type]=this._mediaSource.addSourceBuffer(d);i.addEventListener("error",this.e.onSourceBufferError),i.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(j){f.default.e(this.TAG,j.message),this._emitter.emit(h.default.ERROR,{code:j.code,msg:j.message});return}}this._mimeTypes[c.type]=d}b||this._pendingSegments[c.type].push(c),e||this._sourceBuffers[c.type]&&!this._sourceBuffers[c.type].updating&&this._doAppendSegments(),g.default.safari&&"audio/mpeg"===c.container&&c.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=c.mediaDuration/1000,this._updateMediaSourceDuration())},a.prototype.appendMediaSegment=function(a){var b=a;this._pendingSegments[b.type].push(b),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var c=this._sourceBuffers[b.type];!c||c.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},a.prototype.seek=function(a){for(var b in this._sourceBuffers)if(this._sourceBuffers[b]){var c=this._sourceBuffers[b];if("open"===this._mediaSource.readyState)try{c.abort()}catch(d){f.default.e(this.TAG,d.message)}this._idrList.clear();var e=this._pendingSegments[b];if(e.splice(0,e.length),"closed"!==this._mediaSource.readyState){for(var h=0;h<c.buffered.length;h++){var i=c.buffered.start(h),j=c.buffered.end(h);this._pendingRemoveRanges[b].push({start:i,end:j})}if(c.updating||this._doRemoveRanges(),g.default.safari){var k=this._lastInitSegments[b];k&&(this._pendingSegments[b].push(k),c.updating||this._doAppendSegments())}}}},a.prototype.endOfStream=function(){var a=this._mediaSource,b=this._sourceBuffers;if(!a||"open"!==a.readyState){a&&"closed"===a.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}b.video&&b.video.updating||b.audio&&b.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,a.endOfStream())},a.prototype.getNearestKeyframe=function(a){return this._idrList.getLastSyncPointBeforeDts(a)},a.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var a=this._mediaElement.currentTime;for(var b in this._sourceBuffers){var c=this._sourceBuffers[b];if(c){var d=c.buffered;if(d.length>=1&&a-d.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},a.prototype._doCleanupSourceBuffer=function(){var a=this._mediaElement.currentTime;for(var b in this._sourceBuffers){var c=this._sourceBuffers[b];if(c){for(var d=c.buffered,e=!1,f=0;f<d.length;f++){var g=d.start(f),h=d.end(f);if(g<=a&&a<h+3){if(a-g>=this._config.autoCleanupMaxBackwardDuration){e=!0;var i=a-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[b].push({start:g,end:i})}}else h<a&&(e=!0,this._pendingRemoveRanges[b].push({start:g,end:h}))}e&&!c.updating&&this._doRemoveRanges()}}},a.prototype._updateMediaSourceDuration=function(){var a=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&(!a.video||!a.video.updating)&&(!a.audio||!a.audio.updating)){var b=this._mediaSource.duration,c=this._pendingMediaDuration;c>0&&(isNaN(b)||c>b)&&(f.default.v(this.TAG,"Update MediaSource duration from "+b+" to "+c),this._mediaSource.duration=c),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},a.prototype._doRemoveRanges=function(){for(var a in this._pendingRemoveRanges)if(this._sourceBuffers[a]&&!this._sourceBuffers[a].updating)for(var b=this._sourceBuffers[a],c=this._pendingRemoveRanges[a];c.length&&!b.updating;){var d=c.shift();b.remove(d.start,d.end)}},a.prototype._doAppendSegments=function(){var a=this._pendingSegments;for(var b in a)if(this._sourceBuffers[b]&&!this._sourceBuffers[b].updating&&a[b].length>0){var c=a[b].shift();if(c.timestampOffset){var d=this._sourceBuffers[b].timestampOffset,e=c.timestampOffset/1000;Math.abs(d-e)>0.1&&(f.default.v(this.TAG,"Update MPEG audio timestampOffset from "+d+" to "+e),this._sourceBuffers[b].timestampOffset=e),delete c.timestampOffset}if(!c.data||0===c.data.byteLength)continue;try{this._sourceBuffers[b].appendBuffer(c.data),this._isBufferFull=!1,"video"===b&&c.hasOwnProperty("info")&&this._idrList.appendArray(c.info.syncPoints)}catch(g){this._pendingSegments[b].unshift(c),22===g.code?(this._isBufferFull||this._emitter.emit(h.default.BUFFER_FULL),this._isBufferFull=!0):(f.default.e(this.TAG,g.message),this._emitter.emit(h.default.ERROR,{code:g.code,msg:g.message}))}}},a.prototype._onSourceOpen=function(){if(f.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var a=this._pendingSourceBufferInit;a.length;){var b=a.shift();this.appendInitSegment(b,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(h.default.SOURCE_OPEN)},a.prototype._onSourceEnded=function(){f.default.v(this.TAG,"MediaSource onSourceEnded")},a.prototype._onSourceClose=function(){f.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},a.prototype._hasPendingSegments=function(){var a=this._pendingSegments;return a.video.length>0||a.audio.length>0},a.prototype._hasPendingRemoveRanges=function(){var a=this._pendingRemoveRanges;return a.video.length>0||a.audio.length>0},a.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(h.default.UPDATE_END)},a.prototype._onSourceBufferError=function(a){f.default.e(this.TAG,"SourceBuffer Error: "+a)},a}();b.default=k},"./src/core/mse-events.js":function(a,b,c){"use strict";c.r(b),b.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},"./src/core/transmuxer.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./node_modules/webworkify-webpack/index.js"),g=c.n(f),h=c("./src/utils/logger.js"),i=c("./src/utils/logging-control.js"),j=c("./src/core/transmuxing-controller.js"),k=c("./src/core/transmuxing-events.js"),l=c("./src/core/media-info.js"),m=function(){function a(a,b){if(this.TAG="Transmuxer",this._emitter=new(e())(),b.enableWorker&&"undefined"!=typeof Worker)try{this._worker=g()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[a,b]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},i.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:i.default.getConfig()})}catch(c){h.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new j.default(a,b)}else this._controller=new j.default(a,b);if(this._controller){var d=this._controller;d.on(k.default.IO_ERROR,this._onIOError.bind(this)),d.on(k.default.DEMUX_ERROR,this._onDemuxError.bind(this)),d.on(k.default.INIT_SEGMENT,this._onInitSegment.bind(this)),d.on(k.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),d.on(k.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),d.on(k.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),d.on(k.default.MEDIA_INFO,this._onMediaInfo.bind(this)),d.on(k.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),d.on(k.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),d.on(k.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),d.on(k.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return a.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),i.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(a,b){this._emitter.addListener(a,b)},a.prototype.off=function(a,b){this._emitter.removeListener(a,b)},a.prototype.hasWorker=function(){return null!=this._worker},a.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},a.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},a.prototype.seek=function(a){this._worker?this._worker.postMessage({cmd:"seek",param:a}):this._controller.seek(a)},a.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},a.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},a.prototype._onInitSegment=function(a,b){var c=this;Promise.resolve().then(function(){c._emitter.emit(k.default.INIT_SEGMENT,a,b)})},a.prototype._onMediaSegment=function(a,b){var c=this;Promise.resolve().then(function(){c._emitter.emit(k.default.MEDIA_SEGMENT,a,b)})},a.prototype._onLoadingComplete=function(){var a=this;Promise.resolve().then(function(){a._emitter.emit(k.default.LOADING_COMPLETE)})},a.prototype._onRecoveredEarlyEof=function(){var a=this;Promise.resolve().then(function(){a._emitter.emit(k.default.RECOVERED_EARLY_EOF)})},a.prototype._onMediaInfo=function(a){var b=this;Promise.resolve().then(function(){b._emitter.emit(k.default.MEDIA_INFO,a)})},a.prototype._onMetaDataArrived=function(a){var b=this;Promise.resolve().then(function(){b._emitter.emit(k.default.METADATA_ARRIVED,a)})},a.prototype._onScriptDataArrived=function(a){var b=this;Promise.resolve().then(function(){b._emitter.emit(k.default.SCRIPTDATA_ARRIVED,a)})},a.prototype._onStatisticsInfo=function(a){var b=this;Promise.resolve().then(function(){b._emitter.emit(k.default.STATISTICS_INFO,a)})},a.prototype._onIOError=function(a,b){var c=this;Promise.resolve().then(function(){c._emitter.emit(k.default.IO_ERROR,a,b)})},a.prototype._onDemuxError=function(a,b){var c=this;Promise.resolve().then(function(){c._emitter.emit(k.default.DEMUX_ERROR,a,b)})},a.prototype._onRecommendSeekpoint=function(a){var b=this;Promise.resolve().then(function(){b._emitter.emit(k.default.RECOMMEND_SEEKPOINT,a)})},a.prototype._onLoggingConfigChanged=function(a){this._worker&&this._worker.postMessage({cmd:"logging_config",param:a})},a.prototype._onWorkerMessage=function(a){var b=a.data,c=b.data;if("destroyed"===b.msg||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(b.msg){case k.default.INIT_SEGMENT:case k.default.MEDIA_SEGMENT:this._emitter.emit(b.msg,c.type,c.data);break;case k.default.LOADING_COMPLETE:case k.default.RECOVERED_EARLY_EOF:this._emitter.emit(b.msg);break;case k.default.MEDIA_INFO:Object.setPrototypeOf(c,l.default.prototype),this._emitter.emit(b.msg,c);break;case k.default.METADATA_ARRIVED:case k.default.SCRIPTDATA_ARRIVED:case k.default.STATISTICS_INFO:this._emitter.emit(b.msg,c);break;case k.default.IO_ERROR:case k.default.DEMUX_ERROR:this._emitter.emit(b.msg,c.type,c.info);break;case k.default.RECOMMEND_SEEKPOINT:this._emitter.emit(b.msg,c);break;case"logcat_callback":h.default.emitter.emit("log",c.type,c.logcat);break;default:break}},a}();b.default=m},"./src/core/transmuxing-controller.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./src/utils/logger.js"),g=c("./src/utils/browser.js"),h=c("./src/core/media-info.js"),i=c("./src/demux/flv-demuxer.js"),j=c("./src/remux/mp4-remuxer.js"),k=c("./src/demux/demux-errors.js"),l=c("./src/io/io-controller.js"),m=c("./src/core/transmuxing-events.js"),n=function(){function a(a,b){this.TAG="TransmuxingController",this._emitter=new(e())(),this._config=b,a.segments||(a.segments=[{duration:a.duration,filesize:a.filesize,url:a.url}]),"boolean"!=typeof a.cors&&(a.cors=!0),"boolean"!=typeof a.withCredentials&&(a.withCredentials=!1),this._mediaDataSource=a,this._currentSegmentIndex=0;var c=0;this._mediaDataSource.segments.forEach(function(d){d.timestampBase=c,c+=d.duration,d.cors=a.cors,d.withCredentials=a.withCredentials,b.referrerPolicy&&(d.referrerPolicy=b.referrerPolicy)}),isNaN(c)||this._mediaDataSource.duration===c||(this._mediaDataSource.duration=c),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return a.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(a,b){this._emitter.addListener(a,b)},a.prototype.off=function(a,b){this._emitter.removeListener(a,b)},a.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},a.prototype._loadSegment=function(a,b){this._currentSegmentIndex=a;var c=this._mediaDataSource.segments[a],d=this._ioctl=new l.default(c,this._config,a);d.onError=this._onIOException.bind(this),d.onSeeked=this._onIOSeeked.bind(this),d.onComplete=this._onIOComplete.bind(this),d.onRedirect=this._onIORedirect.bind(this),d.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),b?this._demuxer.bindDataSource(this._ioctl):d.onDataArrival=this._onInitChunkArrival.bind(this),d.open(b)},a.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},a.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},a.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},a.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},a.prototype.seek=function(a){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var b=this._searchSegmentIndexContains(a);if(b===this._currentSegmentIndex){var c=this._mediaInfo.segments[b];if(void 0==c)this._pendingSeekTime=a;else{var d=c.getNearestKeyframe(a);this._remuxer.seek(d.milliseconds),this._ioctl.seek(d.fileposition),this._pendingResolveSeekPoint=d.milliseconds}}else{var e=this._mediaInfo.segments[b];if(void 0==e)this._pendingSeekTime=a,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(b);else{var d=e.getNearestKeyframe(a);this._internalAbort(),this._remuxer.seek(a),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[b].timestampBase,this._loadSegment(b,d.fileposition),this._pendingResolveSeekPoint=d.milliseconds,this._reportSegmentMediaInfo(b)}}this._enableStatisticsReporter()}},a.prototype._searchSegmentIndexContains=function(a){for(var b=this._mediaDataSource.segments,c=b.length-1,d=0;d<b.length;d++)if(a<b[d].timestampBase){c=d-1;break}return c},a.prototype._onInitChunkArrival=function(a,b){var c=this,d=null,e=0;if(b>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,e=this._demuxer.parseChunks(a,b);else if((d=i.default.probe(a)).match){this._demuxer=new i.default(d,this._config),this._remuxer||(this._remuxer=new j.default(this._config));var g=this._mediaDataSource;void 0==g.duration||isNaN(g.duration)||(this._demuxer.overridedDuration=g.duration),"boolean"==typeof g.hasAudio&&(this._demuxer.overridedHasAudio=g.hasAudio),"boolean"==typeof g.hasVideo&&(this._demuxer.overridedHasVideo=g.hasVideo),this._demuxer.timestampBase=g.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),e=this._demuxer.parseChunks(a,b)}else d=null,f.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){c._internalAbort()}),this._emitter.emit(m.default.DEMUX_ERROR,k.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),e=0;return e},a.prototype._onMediaInfo=function(a){var b=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},a),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,h.default.prototype));var c=Object.assign({},a);Object.setPrototypeOf(c,h.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=c,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var a=b._pendingSeekTime;b._pendingSeekTime=null,b.seek(a)})},a.prototype._onMetaDataArrived=function(a){this._emitter.emit(m.default.METADATA_ARRIVED,a)},a.prototype._onScriptDataArrived=function(a){this._emitter.emit(m.default.SCRIPTDATA_ARRIVED,a)},a.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},a.prototype._onIOComplete=function(a){var b=a+1;b<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(b)):(this._remuxer.flushStashedSamples(),this._emitter.emit(m.default.LOADING_COMPLETE),this._disableStatisticsReporter())},a.prototype._onIORedirect=function(a){var b=this._ioctl.extraData;this._mediaDataSource.segments[b].redirectedURL=a},a.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(m.default.RECOVERED_EARLY_EOF)},a.prototype._onIOException=function(a,b){f.default.e(this.TAG,"IOException: type = "+a+", code = "+b.code+", msg = "+b.msg),this._emitter.emit(m.default.IO_ERROR,a,b),this._disableStatisticsReporter()},a.prototype._onDemuxException=function(a,b){f.default.e(this.TAG,"DemuxException: type = "+a+", info = "+b),this._emitter.emit(m.default.DEMUX_ERROR,a,b)},a.prototype._onRemuxerInitSegmentArrival=function(a,b){this._emitter.emit(m.default.INIT_SEGMENT,a,b)},a.prototype._onRemuxerMediaSegmentArrival=function(a,b){if(null==this._pendingSeekTime&&(this._emitter.emit(m.default.MEDIA_SEGMENT,a,b),null!=this._pendingResolveSeekPoint&&"video"===a)){var c=b.info.syncPoints,d=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,g.default.safari&&c.length>0&&c[0].originalDts===d&&(d=c[0].pts),this._emitter.emit(m.default.RECOMMEND_SEEKPOINT,d)}},a.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},a.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},a.prototype._reportSegmentMediaInfo=function(a){var b=this._mediaInfo.segments[a],c=Object.assign({},b);c.duration=this._mediaInfo.duration,c.segmentCount=this._mediaInfo.segmentCount,delete c.segments,delete c.keyframesIndex,this._emitter.emit(m.default.MEDIA_INFO,c)},a.prototype._reportStatisticsInfo=function(){var a={};a.url=this._ioctl.currentURL,a.hasRedirect=this._ioctl.hasRedirect,a.hasRedirect&&(a.redirectedURL=this._ioctl.currentRedirectedURL),a.speed=this._ioctl.currentSpeed,a.loaderType=this._ioctl.loaderType,a.currentSegmentIndex=this._currentSegmentIndex,a.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(m.default.STATISTICS_INFO,a)},a}();b.default=n},"./src/core/transmuxing-events.js":function(a,b,c){"use strict";c.r(b),b.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},"./src/core/transmuxing-worker.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logging-control.js"),e=c("./src/utils/polyfill.js"),f=c("./src/core/transmuxing-controller.js"),g=c("./src/core/transmuxing-events.js");b.default=function(a){var b=null,c=(function(b,c){a.postMessage({msg:"logcat_callback",data:{type:b,logcat:c}})}).bind(this);function h(b,c){var d={msg:g.default.INIT_SEGMENT,data:{type:b,data:c}};a.postMessage(d,[c.data])}function i(b,c){var d={msg:g.default.MEDIA_SEGMENT,data:{type:b,data:c}};a.postMessage(d,[c.data])}function j(){var b={msg:g.default.LOADING_COMPLETE};a.postMessage(b)}function k(){var b={msg:g.default.RECOVERED_EARLY_EOF};a.postMessage(b)}function l(b){var c={msg:g.default.MEDIA_INFO,data:b};a.postMessage(c)}function m(b){var c={msg:g.default.METADATA_ARRIVED,data:b};a.postMessage(c)}function n(b){var c={msg:g.default.SCRIPTDATA_ARRIVED,data:b};a.postMessage(c)}function o(b){var c={msg:g.default.STATISTICS_INFO,data:b};a.postMessage(c)}function p(b,c){a.postMessage({msg:g.default.IO_ERROR,data:{type:b,info:c}})}function q(b,c){a.postMessage({msg:g.default.DEMUX_ERROR,data:{type:b,info:c}})}function r(b){a.postMessage({msg:g.default.RECOMMEND_SEEKPOINT,data:b})}e.default.install(),a.addEventListener("message",function(e){switch(e.data.cmd){case"init":(b=new f.default(e.data.param[0],e.data.param[1])).on(g.default.IO_ERROR,p.bind(this)),b.on(g.default.DEMUX_ERROR,q.bind(this)),b.on(g.default.INIT_SEGMENT,h.bind(this)),b.on(g.default.MEDIA_SEGMENT,i.bind(this)),b.on(g.default.LOADING_COMPLETE,j.bind(this)),b.on(g.default.RECOVERED_EARLY_EOF,k.bind(this)),b.on(g.default.MEDIA_INFO,l.bind(this)),b.on(g.default.METADATA_ARRIVED,m.bind(this)),b.on(g.default.SCRIPTDATA_ARRIVED,n.bind(this)),b.on(g.default.STATISTICS_INFO,o.bind(this)),b.on(g.default.RECOMMEND_SEEKPOINT,r.bind(this));break;case"destroy":b&&(b.destroy(),b=null),a.postMessage({msg:"destroyed"});break;case"start":b.start();break;case"stop":b.stop();break;case"seek":b.seek(e.data.param);break;case"pause":b.pause();break;case"resume":b.resume();break;case"logging_config":var s=e.data.param;d.default.applyConfig(s),!0===s.enableCallback?d.default.addLogListener(c):d.default.removeLogListener(c);break}})}},"./src/demux/amf-parser.js":function(a,b,c){"use strict";c.r(b);var d,e=c("./src/utils/logger.js"),f=c("./src/utils/utf8-conv.js"),g=c("./src/utils/exception.js"),h=(d=new ArrayBuffer(2),new DataView(d).setInt16(0,256,!0),256===new Int16Array(d)[0]),i=function(){function a(){}return a.parseScriptData=function(b,c,d){var f={};try{var g=a.parseValue(b,c,d),h=a.parseValue(b,c+g.size,d-g.size);f[g.data]=h.data}catch(i){e.default.e("AMF",i.toString())}return f},a.parseObject=function(b,c,d){if(d<3)throw new g.IllegalStateException("Data not enough when parse ScriptDataObject");var e=a.parseString(b,c,d),f=a.parseValue(b,c+e.size,d-e.size),h=f.objectEnd;return{data:{name:e.data,value:f.data},size:e.size+f.size,objectEnd:h}},a.parseVariable=function(b,c,d){return a.parseObject(b,c,d)},a.parseString=function(a,b,c){if(c<2)throw new g.IllegalStateException("Data not enough when parse String");var d=new DataView(a,b,c).getUint16(0,!h);return{data:d>0?(0,f.default)(new Uint8Array(a,b+2,d)):"",size:2+d}},a.parseLongString=function(a,b,c){if(c<4)throw new g.IllegalStateException("Data not enough when parse LongString");var d=new DataView(a,b,c).getUint32(0,!h);return{data:d>0?(0,f.default)(new Uint8Array(a,b+4,d)):"",size:4+d}},a.parseDate=function(a,b,c){if(c<10)throw new g.IllegalStateException("Data size invalid when parse Date");var d=new DataView(a,b,c),e=d.getFloat64(0,!h);return e+=60e3*d.getInt16(8,!h),{data:new Date(e),size:10}},a.parseValue=function(b,c,d){if(d<1)throw new g.IllegalStateException("Data not enough when parse Value");var f,i=new DataView(b,c,d),j=1,k=i.getUint8(0),l=!1;try{switch(k){case 0:f=i.getFloat64(1,!h),j+=8;break;case 1:f=!!i.getUint8(1),j+=1;break;case 2:var m=a.parseString(b,c+1,d-1);f=m.data,j+=m.size;break;case 3:f={};var n=0;for((16777215&i.getUint32(d-4,!h))==9&&(n=3);j<d-4;){var o=a.parseObject(b,c+j,d-j-n);if(o.objectEnd)break;f[o.data.name]=o.data.value,j+=o.size}if(j<=d-3){var p=16777215&i.getUint32(j-1,!h);9===p&&(j+=3)}break;case 8:f={},j+=4;var n=0;for((16777215&i.getUint32(d-4,!h))==9&&(n=3);j<d-8;){var q=a.parseVariable(b,c+j,d-j-n);if(q.objectEnd)break;f[q.data.name]=q.data.value,j+=q.size}if(j<=d-3){var p=16777215&i.getUint32(j-1,!h);9===p&&(j+=3)}break;case 9:f=void 0,j=1,l=!0;break;case 10:f=[];var r=i.getUint32(1,!h);j+=4;for(var s=0;s<r;s++){var t=a.parseValue(b,c+j,d-j);f.push(t.data),j+=t.size}break;case 11:var u=a.parseDate(b,c+1,d-1);f=u.data,j+=u.size;break;case 12:var v=a.parseString(b,c+1,d-1);f=v.data,j+=v.size;break;default:j=d,e.default.w("AMF","Unsupported AMF value type "+k)}}catch(w){e.default.e("AMF",w.toString())}return{data:f,size:j,objectEnd:l}},a}();b.default=i},"./src/demux/demux-errors.js":function(a,b,c){"use strict";c.r(b),b.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},"./src/demux/exp-golomb.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/exception.js"),e=function(){function a(a){this.TAG="ExpGolomb",this._buffer=a,this._buffer_index=0,this._total_bytes=a.byteLength,this._total_bits=8*a.byteLength,this._current_word=0,this._current_word_bits_left=0}return a.prototype.destroy=function(){this._buffer=null},a.prototype._fillCurrentWord=function(){var a=this._total_bytes-this._buffer_index;if(a<=0)throw new d.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var b=Math.min(4,a),c=new Uint8Array(4);c.set(this._buffer.subarray(this._buffer_index,this._buffer_index+b)),this._current_word=new DataView(c.buffer).getUint32(0,!1),this._buffer_index+=b,this._current_word_bits_left=8*b},a.prototype.readBits=function(a){if(a>32)throw new d.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(a<=this._current_word_bits_left){var b=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,b}var c=this._current_word_bits_left?this._current_word:0;c>>>=32-this._current_word_bits_left;var e=a-this._current_word_bits_left;this._fillCurrentWord();var f=Math.min(e,this._current_word_bits_left),g=this._current_word>>>32-f;return this._current_word<<=f,this._current_word_bits_left-=f,c=c<<f|g},a.prototype.readBool=function(){return 1===this.readBits(1)},a.prototype.readByte=function(){return this.readBits(8)},a.prototype._skipLeadingZero=function(){var a;for(a=0;a<this._current_word_bits_left;a++)if(0!=(this._current_word&2147483648>>>a))return this._current_word<<=a,this._current_word_bits_left-=a,a;return this._fillCurrentWord(),a+this._skipLeadingZero()},a.prototype.readUEG=function(){var a=this._skipLeadingZero();return this.readBits(a+1)-1},a.prototype.readSEG=function(){var a=this.readUEG();return 1&a?a+1>>>1:-1*(a>>>1)},a}();b.default=e},"./src/demux/flv-demuxer.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logger.js"),e=c("./src/demux/amf-parser.js"),f=c("./src/demux/sps-parser.js"),g=c("./src/demux/demux-errors.js"),h=c("./src/core/media-info.js"),i=c("./src/utils/exception.js"),j=function(){function a(a,b){var c;this.TAG="FLVDemuxer",this._config=b,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=a.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=a.hasAudioTrack,this._hasVideo=a.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new h.default(),this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1000,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1000},this._flvSoundRateTable=[5500,11025,22050,44100,48000],this._mpegSamplingRates=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350],this._mpegAudioV10SampleRateTable=[44100,48000,32000,0],this._mpegAudioV20SampleRateTable=[22050,24000,16000,0],this._mpegAudioV25SampleRateTable=[11025,12000,8000,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},c=new ArrayBuffer(2),new DataView(c).setInt16(0,256,!0),this._littleEndian=256===new Int16Array(c)[0]}return a.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},a.probe=function(a){var b=new Uint8Array(a),c={match:!1};if(70!==b[0]||76!==b[1]||86!==b[2]||1!==b[3])return c;var d,e=(4&b[4])>>>2!=0,f=(1&b[4])!=0,g=(d=b)[5]<<24|d[6]<<16|d[7]<<8|d[8];return g<9?c:{match:!0,consumed:g,dataOffset:g,hasAudioTrack:e,hasVideoTrack:f}},a.prototype.bindDataSource=function(a){return a.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(a.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(a){this._onTrackMetadata=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(a){this._onMediaInfo=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(a){this._onMetaDataArrived=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(a){this._onScriptDataArrived=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(a){this._onDataAvailable=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(a){this._timestampBase=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"overridedDuration",{get:function(){return this._duration},set:function(a){this._durationOverrided=!0,this._duration=a,this._mediaInfo.duration=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"overridedHasAudio",{set:function(a){this._hasAudioFlagOverrided=!0,this._hasAudio=a,this._mediaInfo.hasAudio=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"overridedHasVideo",{set:function(a){this._hasVideoFlagOverrided=!0,this._hasVideo=a,this._mediaInfo.hasVideo=a},enumerable:!1,configurable:!0}),a.prototype.resetMediaInfo=function(){this._mediaInfo=new h.default()},a.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&!!this._hasVideo&&this._videoInitialMetadataDispatched},a.prototype.parseChunks=function(b,c){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new i.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var e=0,f=this._littleEndian;if(0===c){if(!(b.byteLength>13))return 0;e=a.probe(b).dataOffset}if(this._firstParse){this._firstParse=!1,c+e!==this._dataOffset&&d.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var g=new DataView(b,e);0!==g.getUint32(0,!f)&&d.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),e+=4}for(;e<b.byteLength;){this._dispatch=!0;var g=new DataView(b,e);if(e+11+4>b.byteLength)break;var h=g.getUint8(0),j=16777215&g.getUint32(0,!f);if(e+11+j+4>b.byteLength)break;if(8!==h&&9!==h&&18!==h){d.default.w(this.TAG,"Unsupported tag type "+h+", skipped"),e+=11+j+4;continue}var k=g.getUint8(4),l=g.getUint8(5),m=g.getUint8(6),n=g.getUint8(7),o=m|l<<8|k<<16|n<<24,p=16777215&g.getUint32(7,!f);0!==p&&d.default.w(this.TAG,"Meet tag which has StreamID != 0!");var q=e+11;switch(h){case 8:this._parseAudioData(b,q,j,o);break;case 9:this._parseVideoData(b,q,j,o,c+e);break;case 18:this._parseScriptData(b,q,j);break}var r=g.getUint32(11+j,!f);r!==11+j&&d.default.w(this.TAG,"Invalid PrevTagSize "+r),e+=11+j+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),e},a.prototype._parseScriptData=function(a,b,c){var f=e.default.parseScriptData(a,b,c);if(f.hasOwnProperty("onMetaData")){if(null==f.onMetaData||"object"!=typeof f.onMetaData){d.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&d.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=f;var g=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},g)),"boolean"==typeof g.hasAudio&& !1===this._hasAudioFlagOverrided&&(this._hasAudio=g.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof g.hasVideo&& !1===this._hasVideoFlagOverrided&&(this._hasVideo=g.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof g.audiodatarate&&(this._mediaInfo.audioDataRate=g.audiodatarate),"number"==typeof g.videodatarate&&(this._mediaInfo.videoDataRate=g.videodatarate),"number"==typeof g.width&&(this._mediaInfo.width=g.width),"number"==typeof g.height&&(this._mediaInfo.height=g.height),"number"==typeof g.duration){if(!this._durationOverrided){var h=Math.floor(g.duration*this._timescale);this._duration=h,this._mediaInfo.duration=h}}else this._mediaInfo.duration=0;if("number"==typeof g.framerate){var i=Math.floor(1000*g.framerate);if(i>0){var j=i/1000;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=j,this._referenceFrameRate.fps_num=i,this._referenceFrameRate.fps_den=1000,this._mediaInfo.fps=j}}if("object"==typeof g.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var k=g.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(k),g.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=g,d.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(f).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},f))},a.prototype._parseKeyframesIndex=function(a){for(var b=[],c=[],d=1;d<a.times.length;d++){var e=this._timestampBase+Math.floor(1000*a.times[d]);b.push(e),c.push(a.filepositions[d])}return{times:b,filepositions:c}},a.prototype._parseAudioData=function(a,b,c,e){if(c<=1){d.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!0!==this._hasAudioFlagOverrided|| !1!==this._hasAudio){this._littleEndian;var f=new DataView(a,b,c).getUint8(0),h=f>>>4;if(2!==h&&10!==h){this._onError(g.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+h);return}var i=0,j=(12&f)>>>2;if(j>=0&&j<=4)i=this._flvSoundRateTable[j];else{this._onError(g.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+j);return}var k=this._audioMetadata,l=this._audioTrack;if(k||(!1===this._hasAudio&& !1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(k=this._audioMetadata={}).type="audio",k.id=l.id,k.timescale=this._timescale,k.duration=this._duration,k.audioSampleRate=i,k.channelCount=0==(1&f)?1:2),10===h){var m=this._parseAACAudioData(a,b+1,c-1);if(void 0==m)return;if(0===m.packetType){k.config&&d.default.w(this.TAG,"Found another AudioSpecificConfig!");var n=m.data;k.audioSampleRate=n.samplingRate,k.channelCount=n.channelCount,k.codec=n.codec,k.originalCodec=n.originalCodec,k.config=n.config,k.refSampleDuration=1024/k.audioSampleRate*k.timescale,d.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",k);var o=this._mediaInfo;o.audioCodec=k.originalCodec,o.audioSampleRate=k.audioSampleRate,o.audioChannelCount=k.channelCount,o.hasVideo?null!=o.videoCodec&&(o.mimeType="video/x-flv; codecs=\""+o.videoCodec+","+o.audioCodec+"\""):o.mimeType="video/x-flv; codecs=\""+o.audioCodec+"\"",o.isComplete()&&this._onMediaInfo(o)}else if(1===m.packetType){var p=this._timestampBase+e,q={unit:m.data,length:m.data.byteLength,dts:p,pts:p};l.samples.push(q),l.length+=m.data.length}else d.default.e(this.TAG,"Flv: Unsupported AAC data type "+m.packetType)}else if(2===h){if(!k.codec){var n=this._parseMP3AudioData(a,b+1,c-1,!0);if(void 0==n)return;k.audioSampleRate=n.samplingRate,k.channelCount=n.channelCount,k.codec=n.codec,k.originalCodec=n.originalCodec,k.refSampleDuration=1152/k.audioSampleRate*k.timescale,d.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",k);var o=this._mediaInfo;o.audioCodec=k.codec,o.audioSampleRate=k.audioSampleRate,o.audioChannelCount=k.channelCount,o.audioDataRate=n.bitRate,o.hasVideo?null!=o.videoCodec&&(o.mimeType="video/x-flv; codecs=\""+o.videoCodec+","+o.audioCodec+"\""):o.mimeType="video/x-flv; codecs=\""+o.audioCodec+"\"",o.isComplete()&&this._onMediaInfo(o)}var r=this._parseMP3AudioData(a,b+1,c-1,!1);if(void 0==r)return;var p=this._timestampBase+e,s={unit:r,length:r.byteLength,dts:p,pts:p};l.samples.push(s),l.length+=r.length}}},a.prototype._parseAACAudioData=function(a,b,c){if(c<=1){d.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var e={},f=new Uint8Array(a,b,c);return e.packetType=f[0],0===f[0]?e.data=this._parseAACAudioSpecificConfig(a,b+1,c-1):e.data=f.subarray(1),e},a.prototype._parseAACAudioSpecificConfig=function(a,b,c){var d=new Uint8Array(a,b,c),e=null,f=0,h=0,i=0,j=null;if(f=h=d[0]>>>3,i=(7&d[0])<<1|d[1]>>>7,i<0||i>=this._mpegSamplingRates.length){this._onError(g.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var k=this._mpegSamplingRates[i],l=(120&d[1])>>>3;if(l<0||l>=8){this._onError(g.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}5===f&&(j=(7&d[1])<<1|d[2]>>>7,(124&d[2])>>>2);var m=self.navigator.userAgent.toLowerCase();return -1!==m.indexOf("firefox")?i>=6?(f=5,e=new Array(4),j=i-3):(f=2,e=new Array(2),j=i):-1!==m.indexOf("android")?(f=2,e=new Array(2),j=i):(f=5,j=i,e=new Array(4),i>=6?j=i-3:1===l&&(f=2,e=new Array(2),j=i)),e[0]=f<<3,e[0]|=(15&i)>>>1,e[1]=(15&i)<<7,e[1]|=(15&l)<<3,5===f&&(e[1]|=(15&j)>>>1,e[2]=(1&j)<<7,e[2]|=8,e[3]=0),{config:e,samplingRate:k,channelCount:l,codec:"mp4a.40."+f,originalCodec:"mp4a.40."+h}},a.prototype._parseMP3AudioData=function(a,b,c,e){if(c<4){d.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var f=new Uint8Array(a,b,c),g=null;if(e){if(255!==f[0])return;var h=f[1]>>>3&3,i=(6&f[1])>>1,j=(240&f[2])>>>4,k=(12&f[2])>>>2,l=f[3]>>>6&3,m=3!==l?2:1,n=0,o=0,p="mp3";switch(h){case 0:n=this._mpegAudioV25SampleRateTable[k];break;case 2:n=this._mpegAudioV20SampleRateTable[k];break;case 3:n=this._mpegAudioV10SampleRateTable[k];break}switch(i){case 1:j<this._mpegAudioL3BitRateTable.length&&(o=this._mpegAudioL3BitRateTable[j]);break;case 2:j<this._mpegAudioL2BitRateTable.length&&(o=this._mpegAudioL2BitRateTable[j]);break;case 3:j<this._mpegAudioL1BitRateTable.length&&(o=this._mpegAudioL1BitRateTable[j]);break}g={bitRate:o,samplingRate:n,channelCount:m,codec:p,originalCodec:p}}else g=f;return g},a.prototype._parseVideoData=function(a,b,c,e,f){if(c<=1){d.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!0!==this._hasVideoFlagOverrided|| !1!==this._hasVideo){var h=new Uint8Array(a,b,c)[0],i=15&h;if(7!==i){this._onError(g.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+i);return}this._parseAVCVideoPacket(a,b+1,c-1,e,f,(240&h)>>>4)}},a.prototype._parseAVCVideoPacket=function(a,b,c,e,f,h){if(c<4){d.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var i=this._littleEndian,j=new DataView(a,b,c),k=j.getUint8(0),l=16777215&j.getUint32(0,!i);if(0===k)this._parseAVCDecoderConfigurationRecord(a,b+4,c-4);else if(1===k)this._parseAVCVideoData(a,b+4,c-4,e,f,h,l<<8>>8);else if(2===k);else{this._onError(g.default.FORMAT_ERROR,"Flv: Invalid video packet type "+k);return}},a.prototype._parseAVCDecoderConfigurationRecord=function(a,b,c){if(c<7){d.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var e=this._videoMetadata,h=this._videoTrack,i=this._littleEndian,j=new DataView(a,b,c);e?void 0!==e.avcc&&d.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&& !1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(e=this._videoMetadata={}).type="video",e.id=h.id,e.timescale=this._timescale,e.duration=this._duration);var k=j.getUint8(0),l=j.getUint8(1);if(j.getUint8(2),j.getUint8(3),1!==k||0===l){this._onError(g.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(3&j.getUint8(4))+1,3!==this._naluLengthSize&&4!==this._naluLengthSize){this._onError(g.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var m=31&j.getUint8(5);if(0===m){this._onError(g.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}m>1&&d.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+m);for(var n=6,o=0;o<m;o++){var p=j.getUint16(n,!i);if(n+=2,0!==p){var q=new Uint8Array(a,b+n,p);n+=p;var r=f.default.parseSPS(q);if(0===o){e.codecWidth=r.codec_size.width,e.codecHeight=r.codec_size.height,e.presentWidth=r.present_size.width,e.presentHeight=r.present_size.height,e.profile=r.profile_string,e.level=r.level_string,e.bitDepth=r.bit_depth,e.chromaFormat=r.chroma_format,e.sarRatio=r.sar_ratio,e.frameRate=r.frame_rate,(!1===r.frame_rate.fixed||0===r.frame_rate.fps_num||0===r.frame_rate.fps_den)&&(e.frameRate=this._referenceFrameRate);var s=e.frameRate.fps_den,t=e.frameRate.fps_num;e.refSampleDuration=e.timescale*(s/t);for(var u=q.subarray(1,4),v="avc1.",w=0;w<3;w++){var x=u[w].toString(16);x.length<2&&(x="0"+x),v+=x}e.codec=v;var y=this._mediaInfo;y.width=e.codecWidth,y.height=e.codecHeight,y.fps=e.frameRate.fps,y.profile=e.profile,y.level=e.level,y.refFrames=r.ref_frames,y.chromaFormat=r.chroma_format_string,y.sarNum=e.sarRatio.width,y.sarDen=e.sarRatio.height,y.videoCodec=v,y.hasAudio?null!=y.audioCodec&&(y.mimeType="video/x-flv; codecs=\""+y.videoCodec+","+y.audioCodec+"\""):y.mimeType="video/x-flv; codecs=\""+y.videoCodec+"\"",y.isComplete()&&this._onMediaInfo(y)}}}var z=j.getUint8(n);if(0===z){this._onError(g.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}z>1&&d.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+z),n++;for(var o=0;o<z;o++){var p=j.getUint16(n,!i);n+=2,0!==p&&(n+=p)}e.avcc=new Uint8Array(c),e.avcc.set(new Uint8Array(a,b,c),0),d.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",e)},a.prototype._parseAVCVideoData=function(a,b,c,e,f,g,h){for(var i=this._littleEndian,j=new DataView(a,b,c),k=[],l=0,m=0,n=this._naluLengthSize,o=this._timestampBase+e,p=1===g;m<c;){if(m+4>=c){d.default.w(this.TAG,"Malformed Nalu near timestamp "+o+", offset = "+m+", dataSize = "+c);break}var q=j.getUint32(m,!i);if(3===n&&(q>>>=8),q>c-n){d.default.w(this.TAG,"Malformed Nalus near timestamp "+o+", NaluSize > DataSize!");return}var r=31&j.getUint8(m+n);5===r&&(p=!0);var s=new Uint8Array(a,b+m,n+q),t={type:r,data:s};k.push(t),l+=s.byteLength,m+=n+q}if(k.length){var u=this._videoTrack,v={units:k,length:l,isKeyframe:p,dts:o,cts:h,pts:o+h};p&&(v.fileposition=f),u.samples.push(v),u.length+=l}},a}();b.default=j},"./src/demux/sps-parser.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/demux/exp-golomb.js"),e=function(){function a(){}return a._ebsp2rbsp=function(a){for(var b=a,c=b.byteLength,d=new Uint8Array(c),e=0,f=0;f<c;f++)(!(f>=2)||3!==b[f]||0!==b[f-1]||0!==b[f-2])&&(d[e]=b[f],e++);return new Uint8Array(d.buffer,0,e)},a.parseSPS=function(b){var c=a._ebsp2rbsp(b),e=new d.default(c);e.readByte();var f=e.readByte();e.readByte();var g=e.readByte();e.readUEG();var h=a.getProfileString(f),i=a.getLevelString(g),j=1,k=420,l=8;if((100===f||110===f||122===f||244===f||44===f||83===f||86===f||118===f||128===f||138===f||144===f)&&(3===(j=e.readUEG())&&e.readBits(1),j<=3&&(k=[0,420,422,444][j]),l=e.readUEG()+8,e.readUEG(),e.readBits(1),e.readBool()))for(var m=3!==j?8:12,n=0;n<m;n++)e.readBool()&&(n<6?a._skipScalingList(e,16):a._skipScalingList(e,64));e.readUEG();var o=e.readUEG();if(0===o)e.readUEG();else if(1===o){e.readBits(1),e.readSEG(),e.readSEG();for(var p=e.readUEG(),n=0;n<p;n++)e.readSEG()}var q=e.readUEG();e.readBits(1);var r=e.readUEG(),s=e.readUEG(),t=e.readBits(1);0===t&&e.readBits(1),e.readBits(1);var u=0,v=0,w=0,x=0,y=e.readBool();y&&(u=e.readUEG(),v=e.readUEG(),w=e.readUEG(),x=e.readUEG());var z=1,A=1,B=0,C=!0,D=0,E=0,F=e.readBool();if(F){if(e.readBool()){var G=e.readByte(),H=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],I=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];G>0&&G<16?(z=H[G-1],A=I[G-1]):255===G&&(z=e.readByte()<<8|e.readByte(),A=e.readByte()<<8|e.readByte())}if(e.readBool()&&e.readBool(),e.readBool()&&(e.readBits(4),e.readBool()&&e.readBits(24)),e.readBool()&&(e.readUEG(),e.readUEG()),e.readBool()){var J=e.readBits(32),K=e.readBits(32);C=e.readBool(),B=(D=K)/(E=2*J)}}var L=1;(1!==z||1!==A)&&(L=z/A);var M=0,N=0;if(0===j)M=1,N=2-t;else{var O=3===j?1:2,P=1===j?2:1;M=O,N=P*(2-t)}var Q=(r+1)*16,R=(2-t)*((s+1)*16);Q-=(u+v)*M,R-=(w+x)*N;var S=Math.ceil(Q*L);return e.destroy(),e=null,{profile_string:h,level_string:i,bit_depth:l,ref_frames:q,chroma_format:k,chroma_format_string:a.getChromaFormatString(k),frame_rate:{fixed:C,fps:B,fps_den:E,fps_num:D},sar_ratio:{width:z,height:A},codec_size:{width:Q,height:R},present_size:{width:S,height:R}}},a._skipScalingList=function(a,b){for(var c=8,d=8,e=0;e<b;e++)0!==d&&(d=(c+a.readSEG()+256)%256),c=0===d?c:d},a.getProfileString=function(a){switch(a){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},a.getLevelString=function(a){return(a/10).toFixed(1)},a.getChromaFormatString=function(a){switch(a){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},a}();b.default=e},"./src/flv.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/polyfill.js"),e=c("./src/core/features.js"),f=c("./src/io/loader.js"),g=c("./src/player/flv-player.js"),h=c("./src/player/native-player.js"),i=c("./src/player/player-events.js"),j=c("./src/player/player-errors.js"),k=c("./src/utils/logging-control.js"),l=c("./src/utils/exception.js");d.default.install();var m={};m.createPlayer=function(a,b){var c=a;if(null==c||"object"!=typeof c)throw new l.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!c.hasOwnProperty("type"))throw new l.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(c.type){case"flv":return new g.default(c,b);default:return new h.default(c,b)}},m.isSupported=function(){return e.default.supportMSEH264Playback()},m.getFeatureList=function(){return e.default.getFeatureList()},m.BaseLoader=f.BaseLoader,m.LoaderStatus=f.LoaderStatus,m.LoaderErrors=f.LoaderErrors,m.Events=i.default,m.ErrorTypes=j.ErrorTypes,m.ErrorDetails=j.ErrorDetails,m.FlvPlayer=g.default,m.NativePlayer=h.default,m.LoggingControl=k.default,Object.defineProperty(m,"version",{enumerable:!0,get:function(){return"1.6.2"}}),b.default=m},"./src/index.js":function(a,b,c){a.exports=c("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(a,b,c){"use strict";c.r(b);var d,e=c("./src/utils/browser.js"),f=c("./src/io/loader.js"),g=c("./src/utils/exception.js"),h=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c())}),i=function(a){function b(b,c){var d=a.call(this,"fetch-stream-loader")||this;return d.TAG="FetchStreamLoader",d._seekHandler=b,d._config=c,d._needStash=!0,d._requestAbort=!1,d._contentLength=null,d._receivedLength=0,d}return h(b,a),b.isSupported=function(){try{var a=e.default.msedge&&e.default.version.minor>=15048,b=!e.default.msedge||a;return self.fetch&&self.ReadableStream&&b}catch(c){return!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),a.prototype.destroy.call(this)},b.prototype.open=function(a,b){var c=this;this._dataSource=a,this._range=b;var d=a.url;this._config.reuseRedirectedURL&& void 0!=a.redirectedURL&&(d=a.redirectedURL);var e=this._seekHandler.getConfig(d,b),h=new self.Headers();if("object"==typeof e.headers){var i=e.headers;for(var j in i)i.hasOwnProperty(j)&&h.append(j,i[j])}var k={method:"GET",headers:h,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var j in this._config.headers)h.append(j,this._config.headers[j]);!1===a.cors&&(k.mode="same-origin"),a.withCredentials&&(k.credentials="include"),a.referrerPolicy&&(k.referrerPolicy=a.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController(),k.signal=this._abortController.signal),this._status=f.LoaderStatus.kConnecting,self.fetch(e.url,k).then(function(a){if(c._requestAbort){c._status=f.LoaderStatus.kIdle,a.body.cancel();return}if(a.ok&&a.status>=200&&a.status<=299){if(a.url!==e.url&&c._onURLRedirect){var b=c._seekHandler.removeURLParameters(a.url);c._onURLRedirect(b)}var d=a.headers.get("Content-Length");return null!=d&&(c._contentLength=parseInt(d),0!==c._contentLength&&c._onContentLengthKnown&&c._onContentLengthKnown(c._contentLength)),c._pump.call(c,a.body.getReader())}if(c._status=f.LoaderStatus.kError,c._onError)c._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:a.status,msg:a.statusText});else throw new g.RuntimeException("FetchStreamLoader: Http code invalid, "+a.status+" "+a.statusText)}).catch(function(a){if(!c._abortController||!c._abortController.signal.aborted)if(c._status=f.LoaderStatus.kError,c._onError)c._onError(f.LoaderErrors.EXCEPTION,{code:-1,msg:a.message});else throw a})},b.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==f.LoaderStatus.kBuffering||!e.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(a){}},b.prototype._pump=function(a){var b=this;return a.read().then(function(c){if(c.done)if(null!==b._contentLength&&b._receivedLength<b._contentLength){b._status=f.LoaderStatus.kError;var d=f.LoaderErrors.EARLY_EOF,e={code:-1,msg:"Fetch stream meet Early-EOF"};if(b._onError)b._onError(d,e);else throw new g.RuntimeException(e.msg)}else b._status=f.LoaderStatus.kComplete,b._onComplete&&b._onComplete(b._range.from,b._range.from+b._receivedLength-1);else{if(b._abortController&&b._abortController.signal.aborted){b._status=f.LoaderStatus.kComplete;return}if(!0===b._requestAbort)return b._status=f.LoaderStatus.kComplete,a.cancel();b._status=f.LoaderStatus.kBuffering;var h=c.value.buffer,i=b._range.from+b._receivedLength;b._receivedLength+=h.byteLength,b._onDataArrival&&b._onDataArrival(h,i,b._receivedLength),b._pump(a)}}).catch(function(a){if(b._abortController&&b._abortController.signal.aborted){b._status=f.LoaderStatus.kComplete;return}if(11!==a.code||!e.default.msedge){b._status=f.LoaderStatus.kError;var c=0,d=null;if((19===a.code||"network error"===a.message)&&(null===b._contentLength||null!==b._contentLength&&b._receivedLength<b._contentLength)?(c=f.LoaderErrors.EARLY_EOF,d={code:a.code,msg:"Fetch stream meet Early-EOF"}):(c=f.LoaderErrors.EXCEPTION,d={code:a.code,msg:a.message}),b._onError)b._onError(c,d);else throw new g.RuntimeException(d.msg)}})},b}(f.BaseLoader);b.default=i},"./src/io/io-controller.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logger.js"),e=c("./src/io/speed-sampler.js"),f=c("./src/io/loader.js"),g=c("./src/io/fetch-stream-loader.js"),h=c("./src/io/xhr-moz-chunked-loader.js"),i=c("./src/io/xhr-range-loader.js"),j=c("./src/io/websocket-loader.js"),k=c("./src/io/range-seek-handler.js"),l=c("./src/io/param-seek-handler.js"),m=c("./src/utils/exception.js"),n=function(){function a(a,b,c){this.TAG="IOController",this._config=b,this._extraData=c,this._stashInitialSize=393216,void 0!=b.stashInitialSize&&b.stashInitialSize>0&&(this._stashInitialSize=b.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===b.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=a,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(a.url),this._refTotalLength=a.filesize?a.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new e.default(),this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return a.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},a.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},a.prototype.isPaused=function(){return this._paused},Object.defineProperty(a.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"extraData",{get:function(){return this._extraData},set:function(a){this._extraData=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(a){this._onSeeked=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(a){this._onRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(a){this._onRecoveredEarlyEof=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL|| void 0!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentSpeed",{get:function(){return this._loaderClass===i.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),a.prototype._selectSeekHandler=function(){var a=this._config;if("range"===a.seekType)this._seekHandler=new k.default(this._config.rangeLoadZeroStart);else if("param"===a.seekType){var b=a.seekParamStart||"bstart",c=a.seekParamEnd||"bend";this._seekHandler=new l.default(b,c)}else if("custom"===a.seekType){if("function"!=typeof a.customSeekHandler)throw new m.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new a.customSeekHandler()}else throw new m.InvalidArgumentException("Invalid seekType in config: "+a.seekType)},a.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=j.default;else if(g.default.isSupported())this._loaderClass=g.default;else if(h.default.isSupported())this._loaderClass=h.default;else if(i.default.isSupported())this._loaderClass=i.default;else throw new m.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},a.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},a.prototype.open=function(a){this._currentRange={from:0,to:-1},a&&(this._currentRange.from=a),this._speedSampler.reset(),a||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},a.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},a.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},a.prototype.resume=function(){if(this._paused){this._paused=!1;var a=this._resumeFrom;this._resumeFrom=0,this._internalSeek(a,!0)}},a.prototype.seek=function(a){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(a,!0)},a.prototype._internalSeek=function(a,b){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(b),this._loader.destroy(),this._loader=null;var c={from:a,to:-1};this._currentRange={from:c.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,c),this._onSeeked&&this._onSeeked()},a.prototype.updateUrl=function(a){if(!a||"string"!=typeof a||0===a.length)throw new m.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=a},a.prototype._expandBuffer=function(a){for(var b=this._stashSize;b+1048576<a;)b*=2;if((b+=1048576)!==this._bufferSize){var c=new ArrayBuffer(b);if(this._stashUsed>0){var d=new Uint8Array(this._stashBuffer,0,this._stashUsed),e=new Uint8Array(c,0,b);e.set(d,0)}this._stashBuffer=c,this._bufferSize=b}},a.prototype._normalizeSpeed=function(a){var b=this._speedNormalizeList,c=b.length-1,d=0,e=0,f=c;if(a<b[0])return b[0];for(;e<=f;){if((d=e+Math.floor((f-e)/2))===c||a>=b[d]&&a<b[d+1])return b[d];b[d]<a?e=d+1:f=d-1}},a.prototype._adjustStashSize=function(a){var b=0;(b=this._config.isLive?a:a<512?a:a>=512&&a<=1024?Math.floor(1.5*a):2*a)>8192&&(b=8192);var c=1024*b+1048576;this._bufferSize<c&&this._expandBuffer(c),this._stashSize=1024*b},a.prototype._dispatchChunks=function(a,b){return this._currentRange.to=b+a.byteLength-1,this._onDataArrival(a,b)},a.prototype._onURLRedirect=function(a){this._redirectedURL=a,this._onRedirect&&this._onRedirect(a)},a.prototype._onContentLengthKnown=function(a){a&&this._fullRequestFlag&&(this._totalLength=a,this._fullRequestFlag=!1)},a.prototype._onLoaderChunkArrival=function(a,b,c){if(!this._onDataArrival)throw new m.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(a.byteLength);var d=this._speedSampler.lastSecondKBps;if(0!==d){var e=this._normalizeSpeed(d);this._speedNormalized!==e&&(this._speedNormalized=e,this._adjustStashSize(e))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=b),this._stashUsed+a.byteLength<=this._stashSize){var f=new Uint8Array(this._stashBuffer,0,this._stashSize);f.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var f=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var g=this._stashBuffer.slice(0,this._stashUsed),h=this._dispatchChunks(g,this._stashByteStart);if(h<g.byteLength){if(h>0){var i=new Uint8Array(g,h);f.set(i,0),this._stashUsed=i.byteLength,this._stashByteStart+=h}}else this._stashUsed=0,this._stashByteStart+=h;this._stashUsed+a.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+a.byteLength),f=new Uint8Array(this._stashBuffer,0,this._bufferSize)),f.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var h=this._dispatchChunks(a,b);if(h<a.byteLength){var j=a.byteLength-h;j>this._bufferSize&&(this._expandBuffer(j),f=new Uint8Array(this._stashBuffer,0,this._bufferSize)),f.set(new Uint8Array(a,h),0),this._stashUsed+=j,this._stashByteStart=b+h}}}else if(0===this._stashUsed){var h=this._dispatchChunks(a,b);if(h<a.byteLength){var j=a.byteLength-h;j>this._bufferSize&&this._expandBuffer(j);var f=new Uint8Array(this._stashBuffer,0,this._bufferSize);f.set(new Uint8Array(a,h),0),this._stashUsed+=j,this._stashByteStart=b+h}}else{this._stashUsed+a.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+a.byteLength);var f=new Uint8Array(this._stashBuffer,0,this._bufferSize);f.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength;var h=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(h<this._stashUsed&&h>0){var i=new Uint8Array(this._stashBuffer,h);f.set(i,0)}this._stashUsed-=h,this._stashByteStart+=h}}},a.prototype._flushStashBuffer=function(a){if(this._stashUsed>0){var b=this._stashBuffer.slice(0,this._stashUsed),c=this._dispatchChunks(b,this._stashByteStart),e=b.byteLength-c;if(c<b.byteLength)if(a)d.default.w(this.TAG,e+" bytes unconsumed data remain when flush buffer, dropped");else{if(c>0){var f=new Uint8Array(this._stashBuffer,0,this._bufferSize),g=new Uint8Array(b,c);f.set(g,0),this._stashUsed=g.byteLength,this._stashByteStart+=c}return 0}return this._stashUsed=0,this._stashByteStart=0,e}return 0},a.prototype._onLoaderComplete=function(a,b){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},a.prototype._onLoaderError=function(a,b){switch(d.default.e(this.TAG,"Loader error, code = "+b.code+", msg = "+b.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,a=f.LoaderErrors.UNRECOVERABLE_EARLY_EOF),a){case f.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var c=this._currentRange.to+1;c<this._totalLength&&(d.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(c,!1));return}a=f.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case f.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case f.LoaderErrors.CONNECTING_TIMEOUT:case f.LoaderErrors.HTTP_STATUS_CODE_INVALID:case f.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(a,b);else throw new m.RuntimeException("IOException: "+b.msg)},a}();b.default=n},"./src/io/loader.js":function(a,b,c){"use strict";c.r(b),c.d(b,{LoaderStatus:function(){return e},LoaderErrors:function(){return f},BaseLoader:function(){return g}});var d=c("./src/utils/exception.js"),e={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},f={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},g=function(){function a(a){this._type=a||"undefined",this._status=e.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return a.prototype.destroy=function(){this._status=e.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},a.prototype.isWorking=function(){return this._status===e.kConnecting||this._status===e.kBuffering},Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(a){this._onContentLengthKnown=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(a){this._onURLRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),a.prototype.open=function(a,b){throw new d.NotImplementedException("Unimplemented abstract function!")},a.prototype.abort=function(){throw new d.NotImplementedException("Unimplemented abstract function!")},a}()},"./src/io/param-seek-handler.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(a,b){this._startName=a,this._endName=b}return a.prototype.getConfig=function(a,b){var c=a;if(0!==b.from|| -1!==b.to){var d=!0;-1===c.indexOf("?")&&(c+="?",d=!1),d&&(c+="&"),c+=this._startName+"="+b.from.toString(),-1!==b.to&&(c+="&"+this._endName+"="+b.to.toString())}return{url:c,headers:{}}},a.prototype.removeURLParameters=function(a){var b=a.split("?")[0],c=void 0,d=a.indexOf("?");-1!==d&&(c=a.substring(d+1));var e="";if(void 0!=c&&c.length>0)for(var f=c.split("&"),g=0;g<f.length;g++){var h=f[g].split("="),i=g>0;h[0]!==this._startName&&h[0]!==this._endName&&(i&&(e+="&"),e+=f[g])}return 0===e.length?b:b+"?"+e},a}();b.default=d},"./src/io/range-seek-handler.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(a){this._zeroStart=a||!1}return a.prototype.getConfig=function(a,b){var c={};if(0!==b.from|| -1!==b.to){var d=void 0;d=-1!==b.to?"bytes="+b.from.toString()+"-"+b.to.toString():"bytes="+b.from.toString()+"-",c.Range=d}else this._zeroStart&&(c.Range="bytes=0-");return{url:a,headers:c}},a.prototype.removeURLParameters=function(a){return a},a}();b.default=d},"./src/io/speed-sampler.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return a.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},a.prototype.addBytes=function(a){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=a,this._totalBytes+=a):this._now()-this._lastCheckpoint<1000?(this._intervalBytes+=a,this._totalBytes+=a):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=a,this._totalBytes+=a,this._lastCheckpoint=this._now())},Object.defineProperty(a.prototype,"currentKBps",{get:function(){this.addBytes(0);var a=(this._now()-this._lastCheckpoint)/1000;return 0==a&&(a=1),this._intervalBytes/a/1024},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastSecondKBps",{get:function(){return(this.addBytes(0),0!==this._lastSecondBytes)?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"averageKBps",{get:function(){var a=(this._now()-this._firstCheckpoint)/1000;return this._totalBytes/a/1024},enumerable:!1,configurable:!0}),a}();b.default=d},"./src/io/websocket-loader.js":function(a,b,c){"use strict";c.r(b);var d,e=c("./src/io/loader.js"),f=c("./src/utils/exception.js"),g=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c())}),h=function(a){function b(){var b=a.call(this,"websocket-loader")||this;return b.TAG="WebSocketLoader",b._needStash=!0,b._ws=null,b._requestAbort=!1,b._receivedLength=0,b}return g(b,a),b.isSupported=function(){try{return void 0!==self.WebSocket}catch(a){return!1}},b.prototype.destroy=function(){this._ws&&this.abort(),a.prototype.destroy.call(this)},b.prototype.open=function(a){try{var b=this._ws=new self.WebSocket(a.url);b.binaryType="arraybuffer",b.onopen=this._onWebSocketOpen.bind(this),b.onclose=this._onWebSocketClose.bind(this),b.onmessage=this._onWebSocketMessage.bind(this),b.onerror=this._onWebSocketError.bind(this),this._status=e.LoaderStatus.kConnecting}catch(c){this._status=e.LoaderStatus.kError;var d={code:c.code,msg:c.message};if(this._onError)this._onError(e.LoaderErrors.EXCEPTION,d);else throw new f.RuntimeException(d.msg)}},b.prototype.abort=function(){var a=this._ws;a&&(0===a.readyState||1===a.readyState)&&(this._requestAbort=!0,a.close()),this._ws=null,this._status=e.LoaderStatus.kComplete},b.prototype._onWebSocketOpen=function(a){this._status=e.LoaderStatus.kBuffering},b.prototype._onWebSocketClose=function(a){if(!0===this._requestAbort){this._requestAbort=!1;return}this._status=e.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},b.prototype._onWebSocketMessage=function(a){var b=this;if(a.data instanceof ArrayBuffer)this._dispatchArrayBuffer(a.data);else if(a.data instanceof Blob){var c=new FileReader();c.onload=function(){b._dispatchArrayBuffer(c.result)},c.readAsArrayBuffer(a.data)}else{this._status=e.LoaderStatus.kError;var d={code:-1,msg:"Unsupported WebSocket message type: "+a.data.constructor.name};if(this._onError)this._onError(e.LoaderErrors.EXCEPTION,d);else throw new f.RuntimeException(d.msg)}},b.prototype._dispatchArrayBuffer=function(a){var b=a,c=this._receivedLength;this._receivedLength+=b.byteLength,this._onDataArrival&&this._onDataArrival(b,c,this._receivedLength)},b.prototype._onWebSocketError=function(a){this._status=e.LoaderStatus.kError;var b={code:a.code,msg:a.message};if(this._onError)this._onError(e.LoaderErrors.EXCEPTION,b);else throw new f.RuntimeException(b.msg)},b}(e.BaseLoader);b.default=h},"./src/io/xhr-moz-chunked-loader.js":function(a,b,c){"use strict";c.r(b);var d,e=c("./src/utils/logger.js"),f=c("./src/io/loader.js"),g=c("./src/utils/exception.js"),h=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c())}),i=function(a){function b(b,c){var d=a.call(this,"xhr-moz-chunked-loader")||this;return d.TAG="MozChunkedLoader",d._seekHandler=b,d._config=c,d._needStash=!0,d._xhr=null,d._requestAbort=!1,d._contentLength=null,d._receivedLength=0,d}return h(b,a),b.isSupported=function(){try{var a=new XMLHttpRequest();return a.open("GET","https://example.com",!0),a.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===a.responseType}catch(b){return e.default.w("MozChunkedLoader",b.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),a.prototype.destroy.call(this)},b.prototype.open=function(a,b){this._dataSource=a,this._range=b;var c=a.url;this._config.reuseRedirectedURL&& void 0!=a.redirectedURL&&(c=a.redirectedURL);var d=this._seekHandler.getConfig(c,b);this._requestURL=d.url;var e=this._xhr=new XMLHttpRequest();if(e.open("GET",d.url,!0),e.responseType="moz-chunked-arraybuffer",e.onreadystatechange=this._onReadyStateChange.bind(this),e.onprogress=this._onProgress.bind(this),e.onloadend=this._onLoadEnd.bind(this),e.onerror=this._onXhrError.bind(this),a.withCredentials&&(e.withCredentials=!0),"object"==typeof d.headers){var g=d.headers;for(var h in g)g.hasOwnProperty(h)&&e.setRequestHeader(h,g[h])}if("object"==typeof this._config.headers){var g=this._config.headers;for(var h in g)g.hasOwnProperty(h)&&e.setRequestHeader(h,g[h])}this._status=f.LoaderStatus.kConnecting,e.send()},b.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=f.LoaderStatus.kComplete},b.prototype._onReadyStateChange=function(a){var b=a.target;if(2===b.readyState){if(void 0!=b.responseURL&&b.responseURL!==this._requestURL&&this._onURLRedirect){var c=this._seekHandler.removeURLParameters(b.responseURL);this._onURLRedirect(c)}if(0!==b.status&&(b.status<200||b.status>299))if(this._status=f.LoaderStatus.kError,this._onError)this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:b.status,msg:b.statusText});else throw new g.RuntimeException("MozChunkedLoader: Http code invalid, "+b.status+" "+b.statusText);else this._status=f.LoaderStatus.kBuffering}},b.prototype._onProgress=function(a){if(this._status!==f.LoaderStatus.kError){null===this._contentLength&&null!==a.total&&0!==a.total&&(this._contentLength=a.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var b=a.target.response,c=this._range.from+this._receivedLength;this._receivedLength+=b.byteLength,this._onDataArrival&&this._onDataArrival(b,c,this._receivedLength)}},b.prototype._onLoadEnd=function(a){if(!0===this._requestAbort){this._requestAbort=!1;return}this._status!==f.LoaderStatus.kError&&(this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))},b.prototype._onXhrError=function(a){this._status=f.LoaderStatus.kError;var b=0,c=null;if(this._contentLength&&a.loaded<this._contentLength?(b=f.LoaderErrors.EARLY_EOF,c={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(b=f.LoaderErrors.EXCEPTION,c={code:-1,msg:a.constructor.name+" "+a.type}),this._onError)this._onError(b,c);else throw new g.RuntimeException(c.msg)},b}(f.BaseLoader);b.default=i},"./src/io/xhr-range-loader.js":function(a,b,c){"use strict";c.r(b);var d,e=c("./src/utils/logger.js"),f=c("./src/io/speed-sampler.js"),g=c("./src/io/loader.js"),h=c("./src/utils/exception.js"),i=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c())}),j=function(a){function b(b,c){var d=a.call(this,"xhr-range-loader")||this;return d.TAG="RangeLoader",d._seekHandler=b,d._config=c,d._needStash=!1,d._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],d._currentChunkSizeKB=384,d._currentSpeedNormalized=0,d._zeroSpeedChunkCount=0,d._xhr=null,d._speedSampler=new f.default(),d._requestAbort=!1,d._waitForTotalLength=!1,d._totalLengthReceived=!1,d._currentRequestURL=null,d._currentRedirectedURL=null,d._currentRequestRange=null,d._totalLength=null,d._contentLength=null,d._receivedLength=0,d._lastTimeLoaded=0,d}return i(b,a),b.isSupported=function(){try{var a=new XMLHttpRequest();return a.open("GET","https://example.com",!0),a.responseType="arraybuffer","arraybuffer"===a.responseType}catch(b){return e.default.w("RangeLoader",b.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),a.prototype.destroy.call(this)},Object.defineProperty(b.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),b.prototype.open=function(a,b){this._dataSource=a,this._range=b,this._status=g.LoaderStatus.kConnecting;var c=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(c=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||c?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},b.prototype._openSubRange=function(){var a=1024*this._currentChunkSizeKB,b=this._range.from+this._receivedLength,c=b+a;null!=this._contentLength&&c-this._range.from>=this._contentLength&&(c=this._range.from+this._contentLength-1),this._currentRequestRange={from:b,to:c},this._internalOpen(this._dataSource,this._currentRequestRange)},b.prototype._internalOpen=function(a,b){this._lastTimeLoaded=0;var c=a.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?c=this._currentRedirectedURL:void 0!=a.redirectedURL&&(c=a.redirectedURL));var d=this._seekHandler.getConfig(c,b);this._currentRequestURL=d.url;var e=this._xhr=new XMLHttpRequest();if(e.open("GET",d.url,!0),e.responseType="arraybuffer",e.onreadystatechange=this._onReadyStateChange.bind(this),e.onprogress=this._onProgress.bind(this),e.onload=this._onLoad.bind(this),e.onerror=this._onXhrError.bind(this),a.withCredentials&&(e.withCredentials=!0),"object"==typeof d.headers){var f=d.headers;for(var g in f)f.hasOwnProperty(g)&&e.setRequestHeader(g,f[g])}if("object"==typeof this._config.headers){var f=this._config.headers;for(var g in f)f.hasOwnProperty(g)&&e.setRequestHeader(g,f[g])}e.send()},b.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=g.LoaderStatus.kComplete},b.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},b.prototype._onReadyStateChange=function(a){var b=a.target;if(2===b.readyState){if(void 0!=b.responseURL){var c=this._seekHandler.removeURLParameters(b.responseURL);b.responseURL!==this._currentRequestURL&&c!==this._currentRedirectedURL&&(this._currentRedirectedURL=c,this._onURLRedirect&&this._onURLRedirect(c))}if(b.status>=200&&b.status<=299){if(this._waitForTotalLength)return;this._status=g.LoaderStatus.kBuffering}else if(this._status=g.LoaderStatus.kError,this._onError)this._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:b.status,msg:b.statusText});else throw new h.RuntimeException("RangeLoader: Http code invalid, "+b.status+" "+b.statusText)}},b.prototype._onProgress=function(a){if(this._status!==g.LoaderStatus.kError){if(null===this._contentLength){var b=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,b=!0;var c=a.total;this._internalAbort(),null!=c&0!==c&&(this._totalLength=c)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,b){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var d=a.loaded-this._lastTimeLoaded;this._lastTimeLoaded=a.loaded,this._speedSampler.addBytes(d)}},b.prototype._normalizeSpeed=function(a){var b=this._chunkSizeKBList,c=b.length-1,d=0,e=0,f=c;if(a<b[0])return b[0];for(;e<=f;){if((d=e+Math.floor((f-e)/2))===c||a>=b[d]&&a<b[d+1])return b[d];b[d]<a?e=d+1:f=d-1}},b.prototype._onLoad=function(a){if(this._status!==g.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var b=this._speedSampler.lastSecondKBps;if(0===b&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(b=this._speedSampler.currentKBps)),0!==b){var c=this._normalizeSpeed(b);this._currentSpeedNormalized!==c&&(this._currentSpeedNormalized=c,this._currentChunkSizeKB=c)}var d=a.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=d.byteLength;var f=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():f=!0,this._onDataArrival&&this._onDataArrival(d,e,this._receivedLength),f&&(this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},b.prototype._onXhrError=function(a){this._status=g.LoaderStatus.kError;var b=0,c=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(b=g.LoaderErrors.EARLY_EOF,c={code:-1,msg:"RangeLoader meet Early-Eof"}):(b=g.LoaderErrors.EXCEPTION,c={code:-1,msg:a.constructor.name+" "+a.type}),this._onError)this._onError(b,c);else throw new h.RuntimeException(c.msg)},b}(g.BaseLoader);b.default=j},"./src/player/flv-player.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./src/utils/logger.js"),g=c("./src/utils/browser.js"),h=c("./src/player/player-events.js"),i=c("./src/core/transmuxer.js"),j=c("./src/core/transmuxing-events.js"),k=c("./src/core/mse-controller.js"),l=c("./src/core/mse-events.js"),m=c("./src/player/player-errors.js"),n=c("./src/config.js"),o=c("./src/utils/exception.js"),p=function(){function a(a,b){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(e())(),this._config=(0,n.createDefaultConfig)(),"object"==typeof b&&Object.assign(this._config,b),"flv"!==a.type.toLowerCase())throw new o.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===a.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=a,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var c=g.default.chrome&&(g.default.version.major<50||50===g.default.version.major&&g.default.version.build<2661);this._alwaysSeekKeyframe=!!c||!!g.default.msedge||!!g.default.msie,this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return a.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(a,b){var c=this;a===h.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){c._emitter.emit(h.default.MEDIA_INFO,c.mediaInfo)}):a===h.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){c._emitter.emit(h.default.STATISTICS_INFO,c.statisticsInfo)}),this._emitter.addListener(a,b)},a.prototype.off=function(a,b){this._emitter.removeListener(a,b)},a.prototype.attachMediaElement=function(a){var b=this;if(this._mediaElement=a,a.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),a.addEventListener("seeking",this.e.onvSeeking),a.addEventListener("canplay",this.e.onvCanPlay),a.addEventListener("stalled",this.e.onvStalled),a.addEventListener("progress",this.e.onvProgress),this._msectl=new k.default(this._config),this._msectl.on(l.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(l.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(l.default.SOURCE_OPEN,function(){b._mseSourceOpened=!0,b._hasPendingLoad&&(b._hasPendingLoad=!1,b.load())}),this._msectl.on(l.default.ERROR,function(a){b._emitter.emit(h.default.ERROR,m.ErrorTypes.MEDIA_ERROR,m.ErrorDetails.MEDIA_MSE_ERROR,a)}),this._msectl.attachMediaElement(a),null!=this._pendingSeekTime)try{a.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(c){}},a.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},a.prototype.load=function(){var a=this;if(!this._mediaElement)throw new o.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new o.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&& !1===this._mseSourceOpened){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new i.default(this._mediaDataSource,this._config),this._transmuxer.on(j.default.INIT_SEGMENT,function(b,c){a._msectl.appendInitSegment(c)}),this._transmuxer.on(j.default.MEDIA_SEGMENT,function(b,c){if(a._msectl.appendMediaSegment(c),a._config.lazyLoad&&!a._config.isLive){var d=a._mediaElement.currentTime;c.info.endDts>=(d+a._config.lazyLoadMaxDuration)*1000&&null==a._progressChecker&&(f.default.v(a.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),a._suspendTransmuxer())}}),this._transmuxer.on(j.default.LOADING_COMPLETE,function(){a._msectl.endOfStream(),a._emitter.emit(h.default.LOADING_COMPLETE)}),this._transmuxer.on(j.default.RECOVERED_EARLY_EOF,function(){a._emitter.emit(h.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(j.default.IO_ERROR,function(b,c){a._emitter.emit(h.default.ERROR,m.ErrorTypes.NETWORK_ERROR,b,c)}),this._transmuxer.on(j.default.DEMUX_ERROR,function(b,c){a._emitter.emit(h.default.ERROR,m.ErrorTypes.MEDIA_ERROR,b,{code:-1,msg:c})}),this._transmuxer.on(j.default.MEDIA_INFO,function(b){a._mediaInfo=b,a._emitter.emit(h.default.MEDIA_INFO,Object.assign({},b))}),this._transmuxer.on(j.default.METADATA_ARRIVED,function(b){a._emitter.emit(h.default.METADATA_ARRIVED,b)}),this._transmuxer.on(j.default.SCRIPTDATA_ARRIVED,function(b){a._emitter.emit(h.default.SCRIPTDATA_ARRIVED,b)}),this._transmuxer.on(j.default.STATISTICS_INFO,function(b){a._statisticsInfo=a._fillStatisticsInfo(b),a._emitter.emit(h.default.STATISTICS_INFO,Object.assign({},a._statisticsInfo))}),this._transmuxer.on(j.default.RECOMMEND_SEEKPOINT,function(b){a._mediaElement&&!a._config.accurateSeek&&(a._requestSetTime=!0,a._mediaElement.currentTime=b/1000)}),this._transmuxer.open()}},a.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},a.prototype.play=function(){return this._mediaElement.play()},a.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(a){this._mediaElement.volume=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(a){this._mediaElement.muted=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(a){this._mediaElement?this._internalSeek(a):this._pendingSeekTime=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),a.prototype._fillStatisticsInfo=function(a){if(a.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return a;var b=!0,c=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var e=this._mediaElement.getVideoPlaybackQuality();c=e.totalVideoFrames,d=e.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(c=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(a.decodedFrames=c,a.droppedFrames=d),a},a.prototype._onmseUpdateEnd=function(){if(this._config.lazyLoad&&!this._config.isLive){for(var a=this._mediaElement.buffered,b=this._mediaElement.currentTime,c=0,d=0;d<a.length;d++){var e=a.start(d),g=a.end(d);if(e<=b&&b<g){c=g;break}}c>=b+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(f.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},a.prototype._onmseBufferFull=function(){f.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},a.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1000)))},a.prototype._checkProgressAndResume=function(){for(var a=this._mediaElement.currentTime,b=this._mediaElement.buffered,c=!1,d=0;d<b.length;d++){var e=b.start(d),g=b.end(d);if(a>=e&&a<g){a>=g-this._config.lazyLoadRecoverDuration&&(c=!0);break}}c&&(window.clearInterval(this._progressChecker),this._progressChecker=null,c&&(f.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},a.prototype._isTimepointBuffered=function(a){for(var b=this._mediaElement.buffered,c=0;c<b.length;c++){var d=b.start(c),e=b.end(c);if(a>=d&&a<e)return!0}return!1},a.prototype._internalSeek=function(a){var b=this._isTimepointBuffered(a),c=!1,d=0;if(a<1&&this._mediaElement.buffered.length>0){var e=this._mediaElement.buffered.start(0);(e<1&&a<e||g.default.safari)&&(c=!0,d=g.default.safari?0.1:e)}if(c)this._requestSetTime=!0,this._mediaElement.currentTime=d;else if(b){if(this._alwaysSeekKeyframe){var f=this._msectl.getNearestKeyframe(Math.floor(1000*a));this._requestSetTime=!0,null!=f?this._mediaElement.currentTime=f.dts/1000:this._mediaElement.currentTime=a}else this._requestSetTime=!0,this._mediaElement.currentTime=a;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(a),this._transmuxer.seek(Math.floor(1000*a)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=a)},a.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var a=this._mediaElement.currentTime;this._seekpointRecord=null,!this._isTimepointBuffered(a)&&(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(a),this._transmuxer.seek(Math.floor(1000*a)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=a))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},a.prototype._checkAndResumeStuckPlayback=function(a){var b=this._mediaElement;if(a||!this._receivedCanPlay||b.readyState<2){var c=b.buffered;c.length>0&&b.currentTime<c.start(0)&&(f.default.w(this.TAG,"Playback seems stuck at "+b.currentTime+", seek to "+c.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=c.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},a.prototype._onvLoadedMetadata=function(a){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},a.prototype._onvSeeking=function(a){var b=this._mediaElement.currentTime,c=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(b<1&&c.length>0){var d=c.start(0);if(d<1&&b<d||g.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=g.default.safari?0.1:d;return}}if(this._isTimepointBuffered(b)){if(this._alwaysSeekKeyframe){var e=this._msectl.getNearestKeyframe(Math.floor(1000*b));null!=e&&(this._requestSetTime=!0,this._mediaElement.currentTime=e.dts/1000)}null!=this._progressChecker&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:b,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},a.prototype._onvCanPlay=function(a){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},a.prototype._onvStalled=function(a){this._checkAndResumeStuckPlayback(!0)},a.prototype._onvProgress=function(a){this._checkAndResumeStuckPlayback()},a}();b.default=p},"./src/player/native-player.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./src/player/player-events.js"),g=c("./src/config.js"),h=c("./src/utils/exception.js"),i=function(){function a(a,b){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(e())(),this._config=(0,g.createDefaultConfig)(),"object"==typeof b&&Object.assign(this._config,b),"flv"===a.type.toLowerCase())throw new h.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(a.hasOwnProperty("segments"))throw new h.InvalidArgumentException("NativePlayer("+a.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=a,this._mediaElement=null}return a.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(a,b){var c=this;a===f.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){c._emitter.emit(f.default.MEDIA_INFO,c.mediaInfo)}):a===f.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){c._emitter.emit(f.default.STATISTICS_INFO,c.statisticsInfo)}),this._emitter.addListener(a,b)},a.prototype.off=function(a,b){this._emitter.removeListener(a,b)},a.prototype.attachMediaElement=function(a){if(this._mediaElement=a,a.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{a.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(b){}},a.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},a.prototype.load=function(){if(!this._mediaElement)throw new h.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},a.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},a.prototype.play=function(){return this._mediaElement.play()},a.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(a){this._mediaElement.volume=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(a){this._mediaElement.muted=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(a){this._mediaElement?this._mediaElement.currentTime=a:this._pendingSeekTime=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mediaInfo",{get:function(){var a={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(a.duration=Math.floor(1000*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(a.width=this._mediaElement.videoWidth,a.height=this._mediaElement.videoHeight)),a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"statisticsInfo",{get:function(){var a={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return a;var b=!0,c=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var e=this._mediaElement.getVideoPlaybackQuality();c=e.totalVideoFrames,d=e.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(c=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(a.decodedFrames=c,a.droppedFrames=d),a},enumerable:!1,configurable:!0}),a.prototype._onvLoadedMetadata=function(a){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(f.default.MEDIA_INFO,this.mediaInfo)},a.prototype._reportStatisticsInfo=function(){this._emitter.emit(f.default.STATISTICS_INFO,this.statisticsInfo)},a}();b.default=i},"./src/player/player-errors.js":function(a,b,c){"use strict";c.r(b),c.d(b,{ErrorTypes:function(){return f},ErrorDetails:function(){return g}});var d=c("./src/io/loader.js"),e=c("./src/demux/demux-errors.js"),f={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},g={NETWORK_EXCEPTION:d.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:d.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:d.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:d.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:e.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:e.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:e.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(a,b,c){"use strict";c.r(b),b.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},"./src/remux/aac-silent.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.getSilentFrame=function(a,b){if("mp4a.40.2"===a){if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}();b.default=d},"./src/remux/mp4-generator.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.init=function(){for(var b in a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=a.constants={};c.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),c.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),c.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSC=c.STCO=c.STTS,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),c.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),c.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},a.box=function(a){for(var b=8,c=null,d=Array.prototype.slice.call(arguments,1),e=d.length,f=0;f<e;f++)b+=d[f].byteLength;(c=new Uint8Array(b))[0]=b>>>24&255,c[1]=b>>>16&255,c[2]=b>>>8&255,c[3]=255&b,c.set(a,4);for(var g=8,f=0;f<e;f++)c.set(d[f],g),g+=d[f].byteLength;return c},a.generateInitSegment=function(b){var c=a.box(a.types.ftyp,a.constants.FTYP),d=a.moov(b),e=new Uint8Array(c.byteLength+d.byteLength);return e.set(c,0),e.set(d,c.byteLength),e},a.moov=function(b){var c=a.mvhd(b.timescale,b.duration),d=a.trak(b),e=a.mvex(b);return a.box(a.types.moov,c,d,e)},a.mvhd=function(b,c){return a.box(a.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,255&b,c>>>24&255,c>>>16&255,c>>>8&255,255&c,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},a.trak=function(b){return a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.tkhd=function(b){var c=b.id,d=b.duration,e=b.presentWidth,f=b.presentHeight;return a.box(a.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>>8&255,255&e,0,0,f>>>8&255,255&f,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b),a.hdlr(b),a.minf(b))},a.mdhd=function(b){var c=b.timescale,d=b.duration;return a.box(a.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d>>>24&255,d>>>16&255,d>>>8&255,255&d,85,196,0,0]))},a.hdlr=function(b){var c=null;return c="audio"===b.type?a.constants.HDLR_AUDIO:a.constants.HDLR_VIDEO,a.box(a.types.hdlr,c)},a.minf=function(b){var c=null;return c="audio"===b.type?a.box(a.types.smhd,a.constants.SMHD):a.box(a.types.vmhd,a.constants.VMHD),a.box(a.types.minf,c,a.dinf(),a.stbl(b))},a.dinf=function(){return a.box(a.types.dinf,a.box(a.types.dref,a.constants.DREF))},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.constants.STTS),a.box(a.types.stsc,a.constants.STSC),a.box(a.types.stsz,a.constants.STSZ),a.box(a.types.stco,a.constants.STCO))},a.stsd=function(b){return"audio"!==b.type?a.box(a.types.stsd,a.constants.STSD_PREFIX,a.avc1(b)):"mp3"===b.codec?a.box(a.types.stsd,a.constants.STSD_PREFIX,a.mp3(b)):a.box(a.types.stsd,a.constants.STSD_PREFIX,a.mp4a(b))},a.mp3=function(b){var c=b.channelCount,d=b.audioSampleRate,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c,0,16,0,0,0,0,d>>>8&255,255&d,0,0]);return a.box(a.types[".mp3"],e)},a.mp4a=function(b){var c=b.channelCount,d=b.audioSampleRate,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c,0,16,0,0,0,0,d>>>8&255,255&d,0,0]);return a.box(a.types.mp4a,e,a.esds(b))},a.esds=function(b){var c=b.config||[],d=c.length,e=new Uint8Array([0,0,0,0,3,23+d,0,1,0,4,15+d,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([d]).concat(c).concat([6,1,2]));return a.box(a.types.esds,e)},a.avc1=function(b){var c=b.avcc,d=b.codecWidth,e=b.codecHeight,f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>>8&255,255&d,e>>>8&255,255&e,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return a.box(a.types.avc1,f,a.box(a.types.avcC,c))},a.mvex=function(b){return a.box(a.types.mvex,a.trex(b))},a.trex=function(b){var c=b.id,d=new Uint8Array([0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return a.box(a.types.trex,d)},a.moof=function(b,c){return a.box(a.types.moof,a.mfhd(b.sequenceNumber),a.traf(b,c))},a.mfhd=function(b){var c=new Uint8Array([0,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,255&b]);return a.box(a.types.mfhd,c)},a.traf=function(b,c){var d=b.id,e=a.box(a.types.tfhd,new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d])),f=a.box(a.types.tfdt,new Uint8Array([0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c])),g=a.sdtp(b),h=a.trun(b,g.byteLength+16+16+8+16+8+8);return a.box(a.types.traf,e,f,h,g)},a.sdtp=function(b){for(var c=b.samples||[],d=c.length,e=new Uint8Array(4+d),f=0;f<d;f++){var g=c[f].flags;e[f+4]=g.isLeading<<6|g.dependsOn<<4|g.isDependedOn<<2|g.hasRedundancy}return a.box(a.types.sdtp,e)},a.trun=function(b,c){var d=b.samples||[],e=d.length,f=12+16*e,g=new Uint8Array(f);c+=8+f,g.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,255&e,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0);for(var h=0;h<e;h++){var i=d[h].duration,j=d[h].size,k=d[h].flags,l=d[h].cts;g.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,j>>>24&255,j>>>16&255,j>>>8&255,255&j,k.isLeading<<2|k.dependsOn,k.isDependedOn<<6|k.hasRedundancy<<4|k.isNonSync,0,0,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*h)}return a.box(a.types.trun,g)},a.mdat=function(b){return a.box(a.types.mdat,b)},a}();d.init(),b.default=d},"./src/remux/mp4-remuxer.js":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logger.js"),e=c("./src/remux/mp4-generator.js"),f=c("./src/remux/aac-silent.js"),g=c("./src/utils/browser.js"),h=c("./src/core/media-segment-info.js"),i=c("./src/utils/exception.js"),j=function(){function a(a){this.TAG="MP4Remuxer",this._config=a,this._isLive=!0===a.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new h.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new h.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!g.default.chrome&&(g.default.version.major<50||50===g.default.version.major&&g.default.version.build<2661),this._fillSilentAfterSeek=g.default.msedge||g.default.msie,this._mp3UseMpegAudio=!g.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return a.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},a.prototype.bindDataSource=function(a){return a.onDataAvailable=this.remux.bind(this),a.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(a.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(a){this._onInitSegment=a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(a){this._onMediaSegment=a},enumerable:!1,configurable:!0}),a.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},a.prototype.seek=function(a){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},a.prototype.remux=function(a,b){if(!this._onMediaSegment)throw new i.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(a,b),this._remuxVideo(b),this._remuxAudio(a)},a.prototype._onTrackMetadataReceived=function(a,b){var c=null,d="mp4",f=b.codec;if("audio"===a)this._audioMeta=b,"mp3"===b.codec&&this._mp3UseMpegAudio?(d="mpeg",f="",c=new Uint8Array()):c=e.default.generateInitSegment(b);else{if("video"!==a)return;this._videoMeta=b,c=e.default.generateInitSegment(b)}if(!this._onInitSegment)throw new i.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(a,{type:a,data:c.buffer,codec:f,container:a+"/"+d,mediaDuration:b.duration})},a.prototype._calculateDtsBase=function(a,b){this._dtsBaseInited||(a.samples&&a.samples.length&&(this._audioDtsBase=a.samples[0].dts),b.samples&&b.samples.length&&(this._videoDtsBase=b.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},a.prototype.flushStashedSamples=function(){var a=this._videoStashedLastSample,b=this._audioStashedLastSample,c={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=a&&(c.samples.push(a),c.length=a.length);var d={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=b&&(d.samples.push(b),d.length=b.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(c,!0),this._remuxAudio(d,!0)},a.prototype._remuxAudio=function(a,b){if(null!=this._audioMeta){var c=a,i=c.samples,j=void 0,k=-1,l=-1,m=this._audioMeta.refSampleDuration,n="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,o=this._dtsBaseInited&& void 0===this._audioNextDts,p=!1;if(i&&0!==i.length&&(1!==i.length||b)){var q=0,r=null,s=0;n?(q=0,s=c.length):(q=8,s=8+c.length);var t=null;if(i.length>1&&(s-=(t=i.pop()).length),null!=this._audioStashedLastSample){var u=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(u),s+=u.length}null!=t&&(this._audioStashedLastSample=t);var v=i[0].dts-this._dtsBase;if(this._audioNextDts)j=v-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())j=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(p=!0);else{var w=this._audioSegmentInfoList.getLastSampleBefore(v);if(null!=w){var x=v-(w.originalDts+w.duration);x<=3&&(x=0),j=v-(w.dts+w.duration+x)}else j=0}if(p){var y=v-j,z=this._videoSegmentInfoList.getLastSegmentBefore(v);if(null!=z&&z.beginDts<y){var A=f.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(A){var B=z.beginDts,C=y-z.beginDts;d.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+B+", duration: "+C),i.unshift({unit:A,dts:B,pts:B}),s+=A.byteLength}}else p=!1}for(var D=[],E=0;E<i.length;E++){var u=i[E],F=u.unit,G=u.dts-this._dtsBase,B=G,H=!1,I=null,J=0;if(!(G< -0.001)){if("mp3"!==this._audioMeta.codec){var K=G,L=3;if(this._audioNextDts&&(K=this._audioNextDts),(j=G-K)<= -L*m){d.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+G+" ms ,curRefDts: "+K+" ms)  due to dtsCorrection: "+j+" ms overlap.");continue}if(j>=L*m&&this._fillAudioTimestampGap&&!g.default.safari){H=!0;var M=Math.floor(j/m);d.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\n"+("originalDts: "+G+" ms, curRefDts: "+K+" ms, ")+("dtsCorrection: "+Math.round(j)+" ms, generate: "+M+" frames")),B=Math.floor(K),J=Math.floor(K+m)-B;var A=f.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==A&&(d.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),A=F),I=[];for(var N=0;N<M;N++){var O=Math.floor(K+=m),P=Math.floor(K+m)-O,Q={dts:O,pts:O,cts:0,unit:A,size:A.byteLength,duration:P,originalDts:G,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};I.push(Q),s+=Q.size}this._audioNextDts=K+m}else B=Math.floor(K),J=Math.floor(K+m)-B,this._audioNextDts=K+m}else{if(B=G-j,E!==i.length-1){var R=i[E+1].dts-this._dtsBase-j;J=R-B}else if(null!=t){var R=t.dts-this._dtsBase-j;J=R-B}else J=D.length>=1?D[D.length-1].duration:Math.floor(m);this._audioNextDts=B+J}-1===k&&(k=B),D.push({dts:B,pts:B,cts:0,unit:u.unit,size:u.unit.byteLength,duration:J,originalDts:G,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),H&&D.push.apply(D,I)}}if(0===D.length){c.samples=[],c.length=0;return}n?r=new Uint8Array(s):((r=new Uint8Array(s))[0]=s>>>24&255,r[1]=s>>>16&255,r[2]=s>>>8&255,r[3]=255&s,r.set(e.default.types.mdat,4));for(var E=0;E<D.length;E++){var F=D[E].unit;r.set(F,q),q+=F.byteLength}var S=D[D.length-1];l=S.dts+S.duration;var T=new h.MediaSegmentInfo();T.beginDts=k,T.endDts=l,T.beginPts=k,T.endPts=l,T.originalBeginDts=D[0].originalDts,T.originalEndDts=S.originalDts+S.duration,T.firstSample=new h.SampleInfo(D[0].dts,D[0].pts,D[0].duration,D[0].originalDts,!1),T.lastSample=new h.SampleInfo(S.dts,S.pts,S.duration,S.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(T),c.samples=D,c.sequenceNumber++;var U=null;U=n?new Uint8Array():e.default.moof(c,k),c.samples=[],c.length=0;var V={type:"audio",data:this._mergeBoxes(U,r).buffer,sampleCount:D.length,info:T};n&&o&&(V.timestampOffset=k),this._onMediaSegment("audio",V)}}},a.prototype._remuxVideo=function(a,b){if(null!=this._videoMeta){var c=a,d=c.samples,f=void 0,g=-1,i=-1,j=-1,k=-1;if(d&&0!==d.length&&(1!==d.length||b)){var l=8,m=null,n=8+a.length,o=null;if(d.length>1&&(n-=(o=d.pop()).length),null!=this._videoStashedLastSample){var p=this._videoStashedLastSample;this._videoStashedLastSample=null,d.unshift(p),n+=p.length}null!=o&&(this._videoStashedLastSample=o);var q=d[0].dts-this._dtsBase;if(this._videoNextDts)f=q-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())f=0;else{var r=this._videoSegmentInfoList.getLastSampleBefore(q);if(null!=r){var s=q-(r.originalDts+r.duration);s<=3&&(s=0),f=q-(r.dts+r.duration+s)}else f=0}for(var t=new h.MediaSegmentInfo(),u=[],v=0;v<d.length;v++){var p=d[v],w=p.dts-this._dtsBase,x=p.isKeyframe,y=w-f,z=p.cts,A=y+z;-1===g&&(g=y,j=A);var B=0;if(v!==d.length-1){var C=d[v+1].dts-this._dtsBase-f;B=C-y}else if(null!=o){var C=o.dts-this._dtsBase-f;B=C-y}else B=u.length>=1?u[u.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(x){var D=new h.SampleInfo(y,A,B,p.dts,!0);D.fileposition=p.fileposition,t.appendSyncPoint(D)}u.push({dts:y,pts:A,cts:z,units:p.units,size:p.length,isKeyframe:x,duration:B,originalDts:w,flags:{isLeading:0,dependsOn:x?2:1,isDependedOn:x?1:0,hasRedundancy:0,isNonSync:x?0:1}})}(m=new Uint8Array(n))[0]=n>>>24&255,m[1]=n>>>16&255,m[2]=n>>>8&255,m[3]=255&n,m.set(e.default.types.mdat,4);for(var v=0;v<u.length;v++)for(var E=u[v].units;E.length;){var F=E.shift().data;m.set(F,l),l+=F.byteLength}var G=u[u.length-1];if(i=G.dts+G.duration,k=G.pts+G.duration,this._videoNextDts=i,t.beginDts=g,t.endDts=i,t.beginPts=j,t.endPts=k,t.originalBeginDts=u[0].originalDts,t.originalEndDts=G.originalDts+G.duration,t.firstSample=new h.SampleInfo(u[0].dts,u[0].pts,u[0].duration,u[0].originalDts,u[0].isKeyframe),t.lastSample=new h.SampleInfo(G.dts,G.pts,G.duration,G.originalDts,G.isKeyframe),this._isLive||this._videoSegmentInfoList.append(t),c.samples=u,c.sequenceNumber++,this._forceFirstIDR){var H=u[0].flags;H.dependsOn=2,H.isNonSync=0}var I=e.default.moof(c,g);c.samples=[],c.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(I,m).buffer,sampleCount:u.length,info:t})}}},a.prototype._mergeBoxes=function(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);return c.set(a,0),c.set(b,a.byteLength),c},a}();b.default=j},"./src/utils/browser.js":function(a,b,c){"use strict";c.r(b);var d={};!function(){var a=self.navigator.userAgent.toLowerCase(),b=/(edge)\/([\w.]+)/.exec(a)||/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(iemobile)[\/]([\w.]+)/.exec(a)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(firefox)[ \/]([\w.]+)/.exec(a)||[],c=/(ipad)/.exec(a)||/(ipod)/.exec(a)||/(windows phone)/.exec(a)||/(iphone)/.exec(a)||/(kindle)/.exec(a)||/(android)/.exec(a)||/(windows)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||/(cros)/.exec(a)||[],e={browser:b[5]||b[3]||b[1]||"",version:b[2]||b[4]||"0",majorVersion:b[4]||b[2]||"0",platform:c[0]||""},f={};if(e.browser){f[e.browser]=!0;var g=e.majorVersion.split(".");f.version={major:parseInt(e.majorVersion,10),string:e.version},g.length>1&&(f.version.minor=parseInt(g[1],10)),g.length>2&&(f.version.build=parseInt(g[2],10))}if(e.platform&&(f[e.platform]=!0),(f.chrome||f.opr||f.safari)&&(f.webkit=!0),f.rv||f.iemobile){f.rv&&delete f.rv;var h="msie";e.browser=h,f[h]=!0}if(f.edge){delete f.edge;var i="msedge";e.browser=i,f[i]=!0}if(f.opr){var j="opera";e.browser=j,f[j]=!0}if(f.safari&&f.android){var k="android";e.browser=k,f[k]=!0}for(var l in f.name=e.browser,f.platform=e.platform,d)d.hasOwnProperty(l)&&delete d[l];Object.assign(d,f)}(),b.default=d},"./src/utils/exception.js":function(a,b,c){"use strict";c.r(b),c.d(b,{RuntimeException:function(){return f},IllegalStateException:function(){return g},InvalidArgumentException:function(){return h},NotImplementedException:function(){return i}});var d,e=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c())}),f=function(){function a(a){this._message=a}return Object.defineProperty(a.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),a.prototype.toString=function(){return this.name+": "+this.message},a}(),g=function(a){function b(b){return a.call(this,b)||this}return e(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),b}(f),h=function(a){function b(b){return a.call(this,b)||this}return e(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),b}(f),i=function(a){function b(b){return a.call(this,b)||this}return e(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),b}(f)},"./src/utils/logger.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=function(){function a(){}return a.e=function(b,c){(!b||a.FORCE_GLOBAL_TAG)&&(b=a.GLOBAL_TAG);var d="["+b+"] > "+c;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",d),a.ENABLE_ERROR&&(console.error?console.error(d):console.warn?console.warn(d):console.log(d))},a.i=function(b,c){(!b||a.FORCE_GLOBAL_TAG)&&(b=a.GLOBAL_TAG);var d="["+b+"] > "+c;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",d),a.ENABLE_INFO&&(console.info?console.info(d):console.log(d))},a.w=function(b,c){(!b||a.FORCE_GLOBAL_TAG)&&(b=a.GLOBAL_TAG);var d="["+b+"] > "+c;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",d),a.ENABLE_WARN&&(console.warn?console.warn(d):console.log(d))},a.d=function(b,c){(!b||a.FORCE_GLOBAL_TAG)&&(b=a.GLOBAL_TAG);var d="["+b+"] > "+c;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",d),a.ENABLE_DEBUG&&(console.debug?console.debug(d):console.log(d))},a.v=function(b,c){(!b||a.FORCE_GLOBAL_TAG)&&(b=a.GLOBAL_TAG);var d="["+b+"] > "+c;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",d),a.ENABLE_VERBOSE&&console.log(d)},a}();f.GLOBAL_TAG="flv.js",f.FORCE_GLOBAL_TAG=!1,f.ENABLE_ERROR=!0,f.ENABLE_INFO=!0,f.ENABLE_WARN=!0,f.ENABLE_DEBUG=!0,f.ENABLE_VERBOSE=!0,f.ENABLE_CALLBACK=!1,f.emitter=new(e())(),b.default=f},"./src/utils/logging-control.js":function(a,b,c){"use strict";c.r(b);var d=c("./node_modules/events/events.js"),e=c.n(d),f=c("./src/utils/logger.js"),g=function(){function a(){}return Object.defineProperty(a,"forceGlobalTag",{get:function(){return f.default.FORCE_GLOBAL_TAG},set:function(b){f.default.FORCE_GLOBAL_TAG=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"globalTag",{get:function(){return f.default.GLOBAL_TAG},set:function(b){f.default.GLOBAL_TAG=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableAll",{get:function(){return f.default.ENABLE_VERBOSE&&f.default.ENABLE_DEBUG&&f.default.ENABLE_INFO&&f.default.ENABLE_WARN&&f.default.ENABLE_ERROR},set:function(b){f.default.ENABLE_VERBOSE=b,f.default.ENABLE_DEBUG=b,f.default.ENABLE_INFO=b,f.default.ENABLE_WARN=b,f.default.ENABLE_ERROR=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableDebug",{get:function(){return f.default.ENABLE_DEBUG},set:function(b){f.default.ENABLE_DEBUG=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableVerbose",{get:function(){return f.default.ENABLE_VERBOSE},set:function(b){f.default.ENABLE_VERBOSE=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableInfo",{get:function(){return f.default.ENABLE_INFO},set:function(b){f.default.ENABLE_INFO=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableWarn",{get:function(){return f.default.ENABLE_WARN},set:function(b){f.default.ENABLE_WARN=b,a._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(a,"enableError",{get:function(){return f.default.ENABLE_ERROR},set:function(b){f.default.ENABLE_ERROR=b,a._notifyChange()},enumerable:!1,configurable:!0}),a.getConfig=function(){return{globalTag:f.default.GLOBAL_TAG,forceGlobalTag:f.default.FORCE_GLOBAL_TAG,enableVerbose:f.default.ENABLE_VERBOSE,enableDebug:f.default.ENABLE_DEBUG,enableInfo:f.default.ENABLE_INFO,enableWarn:f.default.ENABLE_WARN,enableError:f.default.ENABLE_ERROR,enableCallback:f.default.ENABLE_CALLBACK}},a.applyConfig=function(a){f.default.GLOBAL_TAG=a.globalTag,f.default.FORCE_GLOBAL_TAG=a.forceGlobalTag,f.default.ENABLE_VERBOSE=a.enableVerbose,f.default.ENABLE_DEBUG=a.enableDebug,f.default.ENABLE_INFO=a.enableInfo,f.default.ENABLE_WARN=a.enableWarn,f.default.ENABLE_ERROR=a.enableError,f.default.ENABLE_CALLBACK=a.enableCallback},a._notifyChange=function(){var b=a.emitter;if(b.listenerCount("change")>0){var c=a.getConfig();b.emit("change",c)}},a.registerListener=function(b){a.emitter.addListener("change",b)},a.removeListener=function(b){a.emitter.removeListener("change",b)},a.addLogListener=function(b){f.default.emitter.addListener("log",b),f.default.emitter.listenerCount("log")>0&&(f.default.ENABLE_CALLBACK=!0,a._notifyChange())},a.removeLogListener=function(b){f.default.emitter.removeListener("log",b),0===f.default.emitter.listenerCount("log")&&(f.default.ENABLE_CALLBACK=!1,a._notifyChange())},a}();g.emitter=new(e())(),b.default=g},"./src/utils/polyfill.js":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},Object.assign=Object.assign||function(a){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(null!=d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}return b},"function"!=typeof self.Promise&&c("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},a}();d.install(),b.default=d},"./src/utils/utf8-conv.js":function(a,b,c){"use strict";function d(a,b,c){var d=a;if(!(b+c<d.length))return!1;for(;c--;)if((192&d[++b])!=128)return!1;return!0}c.r(b),b.default=function(a){for(var b=[],c=a,e=0,f=a.length;e<f;){if(c[e]<128){b.push(String.fromCharCode(c[e])),++e;continue}if(c[e]<192);else if(c[e]<224){if(d(c,e,1)){var g=(31&c[e])<<6|63&c[e+1];if(g>=128){b.push(String.fromCharCode(65535&g)),e+=2;continue}}}else if(c[e]<240){if(d(c,e,2)){var g=(15&c[e])<<12|(63&c[e+1])<<6|63&c[e+2];if(g>=2048&&(63488&g)!=55296){b.push(String.fromCharCode(65535&g)),e+=3;continue}}}else if(c[e]<248&&d(c,e,3)){var g=(7&c[e])<<18|(63&c[e+1])<<12|(63&c[e+2])<<6|63&c[e+3];if(g>65536&&g<1114112){g-=65536,b.push(String.fromCharCode(g>>>10|55296)),b.push(String.fromCharCode(1023&g|56320)),e+=4;continue}}b.push(""),++e}return b.join("")}}},b={};function c(d){var e=b[d];if(void 0!==e)return e.exports;var f=b[d]={exports:{}};return a[d].call(f.exports,f,f.exports,c),f.exports}return c.m=a,c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,{a:b}),b},c.d=function(a,b){for(var d in b)c.o(b,d)&&!c.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:b[d]})},c.g=(function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"==typeof window)return window}})(),c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c("./src/index.js")})()})}}])